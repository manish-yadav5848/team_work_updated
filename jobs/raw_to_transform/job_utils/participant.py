
from pyspark.sql import SparkSession
from pyspark.sql.functions import *

from wealthcentral.jobs.raw_to_transform.helper_utils.data_utils import merge_dataframes

def transform(spark: SparkSession, primary_key: list):

    super_omni_newr_particpantaccount_daily_jb_dat_df = spark.sql("select  coalesce(client_id,-9999) as client_id,coalesce(participant_id,-9999) as participant_id,concat(plan_number,'~',participant_id) as retirement_account_id, coalesce(plan_number,-9999) as plan_number,cast(enrollment_date as date) as enrollment_date,cast(free_look_end_date as date) as free_look_end_date,auto_enrollment_indicator,cast(null as VARCHAR(25)) as div_sub_id,cast(hours_of_service as integer) as hours_of_service,participant_account_company_code as part_acc_company_code, participant_account_type_code,participant_account_type_description as participant_account_type_desc,participant_catchup_eligible,participant_name_raw,cast(null as DECIMAL(28,1)) as age,participant_address_line_1,participant_address_line_2,'VRP-SP' as source_system,cast(source_cycle_date as date) as source_cycle_date,cast ( null as VARCHAR(11) ) as part_type,cast ( null as DECIMAL(7,2) ) as attained_age,cast ( null as DATE ) as birth_date,cast ( null as VARCHAR(40) ) as country_name,cast ( null as VARCHAR(1) ) as default_enrolled_qdia,cast ( null as VARCHAR(80) ) as email_address,cast ( alternate_account_number as VARCHAR(13) ) as alternate_account_number,cast ( null as DATE ) as employment_date,cast ( null as VARCHAR(1) ) as federal_part_marital_status,cast ( null as VARCHAR(1) ) as flag_16B,cast ( null as VARCHAR(6) ) as part_acc_plan_code,cast ( null as VARCHAR(2) ) as part_acc_prod_code,cast ( null as VARCHAR(20) ) as part_acc_prod_shrt_nm,cast ( null as DATE ) as part_acct_status_date,cast ( null as VARCHAR(24) ) as part_agg_sys_key,cast ( null as VARCHAR(10) ) as part_gender_code,cast ( null as VARCHAR(3) ) as part_line_of_business,cast ( null as VARCHAR(4) ) as part_location_code,cast ( null as VARCHAR(25) ) as part_middle_name,cast ( null as VARCHAR(5) ) as part_payrole_location,cast ( null as VARCHAR(1) ) as part_person_flag,cast ( null as VARCHAR(32) ) as part_phone,cast ( null as VARCHAR(15) ) as part_post88_surender,cast ( null as VARCHAR(4) ) as part_roth_year,cast(null as Decimal(11,2)) as roth_cost_basis ,cast ( null as VARCHAR(10) ) as part_suffix_title,cast ( null as VARCHAR(13) ) as part_sys_key,cast ( null as VARCHAR(15) ) as part_ytd_ee_contrib,cast ( null as VARCHAR(15) ) as part_ytd_er_contrib,cast ( null as integer ) as part_ytd_hours_worked,cast ( null as VARCHAR(55) ) as participant_account_type,cast ( null as VARCHAR(100) ) as participant_address_city,cast ( null as VARCHAR(100) ) as participant_address_line_3,cast ( null as VARCHAR(3) ) as participant_address_state,cast ( null as VARCHAR(10) ) as participant_address_zip_code,cast ( null as VARCHAR(50) ) as participant_first_name,cast ( null as VARCHAR(1) ) as participant_hce_status,cast ( null as VARCHAR(1) ) as participant_installment_status,cast ( null as VARCHAR(50) ) as participant_last_name,cast ( null as VARCHAR(10) ) as participant_status_code,cast ( participant_id as VARCHAR(17) ) as participant_tin,cast ( right(trim(participant_id),4) as VARCHAR(4) ) as participant_tin_last_four,cast ( null as INTEGER ) as periods_of_continuous_service,cast ( null as DATE ) as plan_entry_date,cast ( null as VARCHAR(1) ) as qdro_flag,cast ( null as DATE ) as reinstatement_notify_date,cast ( null as VARCHAR(55) ) as sex,cast ( null as DATE ) as suspension_date,cast ( null as DATE ) as termination_date,cast(null as INTEGER) as marital_status,cast(null as VARCHAR(10)) as part_acc_status_text,cast(null as VARCHAR(6)) as part_product_id,cast(null as INTEGER) as ee_contrib_401k_state_tax_flag,cast(null as DECIMAL(11,2)) as ee_contrib_401k_current_year,cast(null as DECIMAL(11,2)) as ee_contrib_401k_prior_year,cast(null as DATE) as eligibility_5500_date,cast(null as DATE) as account_inception_date,cast(null as VARCHAR(1)) as account_type,cast(null as DECIMAL(11,2)) as addl_high_outst_loan_balance,cast(null as VARCHAR(1)) as address_validity,cast(null as INTEGER) as advice_account_indicator,cast(null as VARCHAR(1)) as advice_account_rebal_freq,cast(null as INTEGER) as advice_target_message_1,cast(null as INTEGER) as advice_target_message_2,cast(null as INTEGER) as advice_target_message_3,cast(null as VARCHAR(2)) as alternate_taxability_state,cast(null as DATE) as alternate_vesting_date,cast(null as DECIMAL(11,2)) as annual_dist_amount,cast(null as DECIMAL(11,2)) as annual_salary,cast(null as DATE) as auto_enrollment_date,cast(null as VARCHAR(1)) as automatic_increase_flag,cast(null as VARCHAR(1)) as beneficiary_code,cast(null as VARCHAR(20)) as brokerage_account_number,cast(null as VARCHAR(10)) as client_pass_thru_identifier,cast(null as VARCHAR(10)) as client_status,cast(null as VARCHAR(10)) as code2,cast(null as DECIMAL(11,2)) as contribution_415_current,cast(null as DECIMAL(11,2)) as contribution_415_prior,cast(null as INTEGER) as death_benefit_percentage,cast(null as DATE) as death_date,cast(null as VARCHAR(1)) as default_deferral_flag,cast(null as VARCHAR(1)) as default_investment_flag,cast(null as DATE) as defer_date,cast(null as VARCHAR(4)) as deferral_grouping_id,cast(null as DATE) as demographic_effective_date,cast(null as DECIMAL(4,1)) as div_pass_thru_indicator,cast(null as DECIMAL(5,4)) as dividend_pass_thru_election,cast(null as DECIMAL(4,1)) as divid_pass_thru_election_pct,cast(null as DATE) as dollar5000_reached_date,cast(null as INTEGER) as ee_contrib_taxed_by_state,cast(null as INTEGER) as egtrra_target_message_id,cast(null as DATE) as eligibility_completion_date,cast(null as DATE) as eligibility_date,cast(null as VARCHAR(1)) as eligibility_exclusion,cast(null as DATE) as eligibility_reminder_date,cast(null as VARCHAR(1)) as eligible_for_bonus,cast(null as DATE) as eligible_for_distribution_date,cast(null as DECIMAL(11,2)) as elig_rollover_distributions,cast(null  as VARCHAR(13)) as employee_number,cast(null  as VARCHAR(13)) as employee_number_2,cast(null as VARCHAR(1)) as employment_status_reason,cast(null as DECIMAL(11,2)) as equity_wash_amount,cast(null as DECIMAL(11,2)) as er_after_tax,cast(null as DECIMAL(11,2)) as esop_diversification_shares,cast(null as DATE) as excess_trader_suspend_end_date,cast(null as VARCHAR(1)) as excess_trader_suspend_flag,cast(null as DATE) as excess_trader_susp_start_date,cast(null as VARCHAR(100)) as participant_name, cast(null as VARCHAR(1)) as federal_w4p_form_status,cast(null as VARCHAR(1)) as financial_engins_prospect_code,cast(null as date) as first_contribution_date,cast(null as DATE) as first_default_contrib_date,cast(null as VARCHAR(3)) as foreign_country_code,cast(null as INTEGER) as gender,cast(null as VARCHAR(1)) as group_payment_status_flag,cast(null as INTEGER) as hce_indicator,cast(null as DECIMAL(11,2)) as high_loan_balance_amount,cast(null as INTEGER) as highly_compensated_ee_flag,cast(null as INTEGER) as human_resouce_status_code,cast(null as DECIMAL(11,2)) as ilip_equity_wash_residual_amt,cast(null as DATE) as init_partial_term_dist_date,cast(null as DATE) as init_rollover_dist_date,cast(null as INTEGER) as inside_trading_16b_restrict_id,cast(null as INTEGER) as key_employee_indicator,cast(null as VARCHAR(3)) as language_print_preference,cast(null as DATE) as last_alloc_pct_change_date,cast(null as DATE) as last_contrib_rate_change_date,cast(null as DECIMAL(17,2)) as last_contribution_amt_gross,cast(null as DATE) as last_contribution_date,cast(null as DATE) as last_hardship_withdrawal_date,cast(null as DATE) as last_loan_default_date,cast(null as DATE) as last_plan_to_plan_transf_date,cast(null as DATE) as last_transfer_date,cast(null as DATE) as leave_of_absense_end_date,cast(null as DECIMAL(11,2)) as lifetime_dsc_amount,cast(null as DECIMAL(11,2)) as managed_acct_salary_at_enroll,cast(null as VARCHAR(5)) as match_payroll_generic_grouping,cast(null as VARCHAR(1)) as min_distrib_begin_time_option,cast(null as VARCHAR(1)) as min_distrib_calculation_method,cast(null as DATE) as min_distrib_eligibility_date,cast(null as VARCHAR(1)) as min_distrib_suppress_option,cast(null as DATE) as mva_charged_to_date,cast(null as DECIMAL(11,2)) as net_401k_elective_deferrals,cast(null as DATE) as next_rebalance_date,cast(null as VARCHAR(10)) as nonqual_ind,cast(null as VARCHAR(80)) as old_advice_account,cast(null as INTEGER) as oracle_plan_rule_id,cast(null as VARCHAR(1)) as override_withholding,cast(null as DECIMAL(11,2)) as override_withholding_amount,cast(null as DECIMAL(5,4)) as override_withholding_pct,cast(null as VARCHAR(4)) as  part_suffix,cast(null as VARCHAR(1)) as participant_16b_status,cast(null as VARCHAR(10)) as participant_account_status_desc,cast(null as VARCHAR(40)) as participant_address_line_4,cast(null as VARCHAR(13)) as participant_employee_id,cast(null as date) as participant_fe_end_date,cast(null as DATE) as participant_fe_start_date,cast(null as INTEGER) as participant_gender,cast(null as INTEGER) as participant_gender_code,cast(null as INTEGER) as participant_marital_status,cast(null as VARCHAR(40)) as participant_name_formatted,cast(null as VARCHAR(30)) as participant_name_protect,cast(null as VARCHAR(1)) as participant_person_flag,cast(null as VARCHAR(1)) as participant_qdro_status,cast(null as VARCHAR(10)) as participant_status,cast(null as VARCHAR(3)) as pay_group_id,cast(null as VARCHAR(1)) as payroll_frequency,cast(null as VARCHAR(8)) as plan_reference_key,cast(null as DECIMAL(15,2)) as plan_year_compensation_current,cast(null as VARCHAR(2)) as group_iv_id,cast(null as DECIMAL(15,2)) as plan_year_compensation_prior,cast(null as DECIMAL(11,2)) as post1986_ee_aftertax_contrib,cast(null as DECIMAL(11,2)) as pre_tax_401k_contrib_current,cast(null as DECIMAL(11,2)) as pre_tax_401k_contrib_prior,cast(null as DECIMAL(11,2)) as pre1987_ee_aftertax_contrib,cast(null as INTEGER) as prior_hce_indicator,cast(null as DATE) as processing_date,cast(null as VARCHAR(3)) as puerto_rico_resident,cast(null as DATE) as qdia_date,cast(null as VARCHAR(1)) as qdia_indicator,cast(null as DECIMAL(11,2)) as qdro_beneficary_actual_ssn,cast(null as VARCHAR(254)) as reduction_401k_option,cast(null as VARCHAR(25)) as related_participant_id,cast(null as VARCHAR(1)) as roll_account_type,cast(null as DECIMAL(11,2)) as roll_contribution_current_year,cast(null as DECIMAL(11,2)) as roll_contribution_prior_year,cast(null as DECIMAL(11,2)) as roth_deferral_contributions,cast(null as DATE) as roth_first_contribution_date,cast(null as DECIMAL(11,2)) as roth_iprr_contributions,cast(null as VARCHAR(254)) as roth_sma_account_number,cast(null as DECIMAL(11,2)) as roth_unrestricted_contrib,cast(null as VARCHAR(1)) as sdbo_hold_harmless,cast(null as VARCHAR(1)) as sma_fund_balance,cast(null as VARCHAR(9)) as social_security_number,cast(null as DECIMAL(4,3)) as source_adj_vest_percent,cast(null as DATE) as source_processing_date,cast(null as DATE) as spouse_consent_expiration_date,cast(null as DATE) as spouse_birth_date,cast(null as VARCHAR(30)) as spouse_name,cast(null as INTEGER) as suspension_months_ee_contrib,cast(null as INTEGER) as suspension_months_er_contrib,cast(null as INTEGER) as suspension_months_forf_realloc,cast(null as VARCHAR(3)) as tax_treaty_country_code,cast(null as DATE) as termination_notification_date,cast(null as VARCHAR(1)) as termination_reason_code,cast(null as INTEGER) as total_number_of_funds,cast(null as INTEGER) as trade_activity,cast(null as VARCHAR(254)) as very_important_person_indicat,cast(null as VARCHAR(1)) as withdrawal_restriction,cast(null as VARCHAR(1)) as withdrawal_restriction_reason,cast(null as DATE) as  last_crc_rate_chg_dt,cast(null as VARCHAR(2)) as term_stat_reason_code,cast(null AS VARCHAR(1)) as cntrbs_txd_by_st_flg,cast(null as DECIMAL(7,2)) as ee_cntrb_pty,cast(null as DECIMAL(7,2)) as ee_cntrb_ytd,cast('0.00' as DECIMAL(15,2)) as ytd_contributions,cast(null as VARCHAR(1)) as roth_catch_up_flag,cast(null as DECIMAL(11,2)) as rehire_accum_hours,cast(null as VARCHAR(1)) as rehire_ee_category,cast(null as DATE) as rehire_effective_date,cast(null as DATE) as rehire_last_change_date,cast(null as DECIMAL(16,2)) as loan_variable_loan_fee_amt,cast(null as VARCHAR(1)) as loan_variable_loan_fee_payor,cast(null as varchar(25)) as loan_fee_var_maint_payor_desc from super_omni_newr_particpantaccount_daily_jb_dat;")

    super_omni_newr_particpantaccount_daily_ng_dat_df = spark.sql("select  coalesce(client_id,-9999) as client_id,coalesce(participant_id,-9999) as participant_id,concat(plan_number,'~',participant_id) as retirement_account_id, coalesce(plan_number,-9999) as plan_number,cast(enrollment_date as date) as enrollment_date,cast(free_look_end_date as date) as free_look_end_date,auto_enrollment_indicator,cast(hours_of_service as integer) as hours_of_service,participant_account_company_code as part_acc_company_code, participant_account_type_code,cast(null as VARCHAR(25)) as div_sub_id,participant_account_type_description as participant_account_type_desc,participant_catchup_eligible,participant_name_raw,cast(null as VARCHAR(100)) as participant_name,cast(null as DECIMAL(28,1)) as age,participant_address_line_1,participant_address_line_2,'VRP-PB' as source_system,cast(source_cycle_date as date) as source_cycle_date,cast ( null as VARCHAR(11) ) as part_type,cast ( null as DECIMAL(7,2) ) as attained_age,cast ( null as DATE ) as birth_date,cast ( null as VARCHAR(40) ) as country_name,cast ( null as VARCHAR(1) ) as default_enrolled_qdia,cast ( null as VARCHAR(80) ) as email_address,cast ( alternate_account_number as VARCHAR(13) ) as alternate_account_number,cast ( null as DATE ) as employment_date,cast ( null as VARCHAR(1) ) as federal_part_marital_status,cast ( null as VARCHAR(1) ) as flag_16B,cast ( null as VARCHAR(6) ) as part_acc_plan_code,cast ( null as VARCHAR(2) ) as part_acc_prod_code,cast ( null as VARCHAR(20) ) as part_acc_prod_shrt_nm,cast ( null as DATE ) as part_acct_status_date,cast ( null as VARCHAR(24) ) as part_agg_sys_key,cast ( null as VARCHAR(10) ) as part_gender_code,cast ( null as VARCHAR(3) ) as part_line_of_business,cast ( null as VARCHAR(4) ) as part_location_code,cast ( null as VARCHAR(25) ) as part_middle_name,cast ( null as VARCHAR(5) ) as part_payrole_location,cast ( null as VARCHAR(1) ) as part_person_flag,cast ( null as VARCHAR(32) ) as part_phone,cast ( null as VARCHAR(15) ) as part_post88_surender,cast ( null as VARCHAR(4) ) as part_roth_year,cast(null as Decimal(11,2)) as roth_cost_basis ,cast ( null as VARCHAR(10) ) as part_suffix_title,cast ( null as VARCHAR(13) ) as part_sys_key,cast ( null as VARCHAR(15) ) as part_ytd_ee_contrib,cast ( null as VARCHAR(15) ) as part_ytd_er_contrib,cast ( null as integer ) as part_ytd_hours_worked,cast ( null as VARCHAR(55) ) as participant_account_type,cast ( null as VARCHAR(100) ) as participant_address_city,cast ( null as VARCHAR(100) ) as participant_address_line_3,cast ( null as VARCHAR(3) ) as participant_address_state,cast ( null as VARCHAR(10) ) as participant_address_zip_code,cast ( null as VARCHAR(50) ) as participant_first_name,cast ( null as VARCHAR(1) ) as participant_hce_status,cast ( null as VARCHAR(1) ) as participant_installment_status,cast ( null as VARCHAR(50) ) as participant_last_name,cast ( null as VARCHAR(10) ) as participant_status_code,cast ( participant_id as VARCHAR(17) ) as participant_tin,cast ( right(trim(participant_id),4) as VARCHAR(4) ) as participant_tin_last_four,cast ( null as INTEGER ) as periods_of_continuous_service,cast ( null as DATE ) as plan_entry_date,cast ( null as VARCHAR(1) ) as qdro_flag,cast ( null as DATE ) as reinstatement_notify_date,cast ( null as VARCHAR(55) ) as sex,cast ( null as DATE ) as suspension_date,cast ( null as DATE ) as termination_date,cast(null as INTEGER) as marital_status,cast(null as VARCHAR(10)) as part_acc_status_text,cast(null as VARCHAR(6)) as part_product_id,cast(null as INTEGER) as ee_contrib_401k_state_tax_flag,cast(null as DECIMAL(11,2)) as ee_contrib_401k_current_year,cast(null as DECIMAL(11,2)) as ee_contrib_401k_prior_year,cast(null as DATE) as eligibility_5500_date,cast(null as DATE) as account_inception_date,cast(null as VARCHAR(1)) as account_type,cast(null as DECIMAL(11,2)) as addl_high_outst_loan_balance,cast(null as VARCHAR(1)) as address_validity,cast(null as INTEGER) as advice_account_indicator,cast(null as VARCHAR(1)) as advice_account_rebal_freq,cast(null as INTEGER) as advice_target_message_1,cast(null as INTEGER) as advice_target_message_2,cast(null as INTEGER) as advice_target_message_3,cast(null as VARCHAR(2)) as alternate_taxability_state,cast(null as DATE) as alternate_vesting_date,cast(null as DECIMAL(11,2)) as annual_dist_amount,cast(null as DECIMAL(11,2)) as annual_salary,cast(null as DATE) as auto_enrollment_date,cast(null as VARCHAR(1)) as automatic_increase_flag,cast(null as VARCHAR(1)) as beneficiary_code,cast(null as VARCHAR(20)) as brokerage_account_number,cast(null as VARCHAR(10)) as client_pass_thru_identifier,cast(null as VARCHAR(10)) as client_status,cast(null as VARCHAR(10)) as code2,cast(null as DECIMAL(11,2)) as contribution_415_current,cast(null as DECIMAL(11,2)) as contribution_415_prior,cast(null as INTEGER) as death_benefit_percentage,cast(null as DATE) as death_date,cast(null as VARCHAR(1)) as default_deferral_flag,cast(null as VARCHAR(1)) as default_investment_flag,cast(null as DATE) as defer_date,cast(null as VARCHAR(4)) as deferral_grouping_id,cast(null as DATE) as demographic_effective_date,cast(null as DECIMAL(4,1)) as div_pass_thru_indicator,cast(null as DECIMAL(5,4)) as dividend_pass_thru_election,cast(null as DECIMAL(4,1)) as divid_pass_thru_election_pct,cast(null as DATE) as dollar5000_reached_date,cast(null as INTEGER) as ee_contrib_taxed_by_state,cast(null as INTEGER) as egtrra_target_message_id,cast(null as DATE) as eligibility_completion_date,cast(null as DATE) as eligibility_date,cast(null as VARCHAR(1)) as eligibility_exclusion,cast(null as DATE) as eligibility_reminder_date,cast(null as VARCHAR(1)) as eligible_for_bonus,cast(null as DATE) as eligible_for_distribution_date,cast(null as DECIMAL(11,2)) as elig_rollover_distributions,cast(null  as VARCHAR(13)) as employee_number,cast(null as VARCHAR(1)) as employment_status_reason,cast(null as DECIMAL(11,2)) as equity_wash_amount,cast(null as DECIMAL(11,2)) as er_after_tax,cast(null as DECIMAL(11,2)) as esop_diversification_shares,cast(null as DATE) as excess_trader_suspend_end_date,cast(null as VARCHAR(1)) as excess_trader_suspend_flag,cast(null as DATE) as excess_trader_susp_start_date,cast(null as VARCHAR(1)) as federal_w4p_form_status,cast(null as VARCHAR(1)) as financial_engins_prospect_code,cast(null as date) as first_contribution_date,cast(null as DATE) as first_default_contrib_date,cast(null as VARCHAR(3)) as foreign_country_code,cast(null as INTEGER) as gender,cast(null as VARCHAR(1)) as group_payment_status_flag,cast(null as INTEGER) as hce_indicator,cast(null as DECIMAL(11,2)) as high_loan_balance_amount,cast(null as INTEGER) as highly_compensated_ee_flag,cast(null as INTEGER) as human_resouce_status_code,cast(null as DECIMAL(11,2)) as ilip_equity_wash_residual_amt,cast(null as DATE) as init_partial_term_dist_date,cast(null as DATE) as init_rollover_dist_date,cast(null as INTEGER) as inside_trading_16b_restrict_id,cast(null as INTEGER) as key_employee_indicator,cast(null as VARCHAR(3)) as language_print_preference,cast(null as DATE) as last_alloc_pct_change_date,cast(null as DATE) as last_contrib_rate_change_date,cast(null as DECIMAL(17,2)) as last_contribution_amt_gross,cast(null as DATE) as last_contribution_date,cast(null as DATE) as last_hardship_withdrawal_date,cast(null as DATE) as last_loan_default_date,cast(null as DATE) as last_plan_to_plan_transf_date,cast(null as DATE) as last_transfer_date,cast(null as DATE) as leave_of_absense_end_date,cast(null as DECIMAL(11,2)) as lifetime_dsc_amount,cast(null as DECIMAL(11,2)) as managed_acct_salary_at_enroll,cast(null as VARCHAR(5)) as match_payroll_generic_grouping,cast(null as VARCHAR(1)) as min_distrib_begin_time_option,cast(null as VARCHAR(1)) as min_distrib_calculation_method,cast(null as DATE) as min_distrib_eligibility_date,cast(null as VARCHAR(1)) as min_distrib_suppress_option,cast(null as DATE) as mva_charged_to_date,cast(null as DECIMAL(11,2)) as net_401k_elective_deferrals,cast(null as DATE) as next_rebalance_date,cast(null as VARCHAR(10)) as nonqual_ind,cast(null as VARCHAR(80)) as old_advice_account,cast(null as INTEGER) as oracle_plan_rule_id,cast(null as VARCHAR(1)) as override_withholding,cast(null as DECIMAL(11,2)) as override_withholding_amount,cast(null as DECIMAL(5,4)) as override_withholding_pct,cast(null as VARCHAR(4)) as  part_suffix,cast(null as VARCHAR(1)) as participant_16b_status,cast(null as VARCHAR(10)) as participant_account_status_desc,cast(null as VARCHAR(40)) as participant_address_line_4,cast(null as VARCHAR(13)) as participant_employee_id,cast(null as date) as participant_fe_end_date,cast(null as DATE) as participant_fe_start_date,cast(null as INTEGER) as participant_gender,cast(null as INTEGER) as participant_gender_code,cast(null as INTEGER) as participant_marital_status,cast(null as VARCHAR(40)) as participant_name_formatted,cast(null as VARCHAR(30)) as participant_name_protect,cast(null as VARCHAR(1)) as participant_person_flag,cast(null as VARCHAR(1)) as participant_qdro_status,cast(null as VARCHAR(10)) as participant_status,cast(null as VARCHAR(3)) as pay_group_id,cast(null as VARCHAR(1)) as payroll_frequency,cast(null as VARCHAR(8)) as plan_reference_key,cast(null as DECIMAL(15,2)) as plan_year_compensation_current,cast(null as VARCHAR(2)) as group_iv_id,cast(null as DECIMAL(15,2)) as plan_year_compensation_prior,cast(null as DECIMAL(11,2)) as post1986_ee_aftertax_contrib,cast(null as DECIMAL(11,2)) as pre_tax_401k_contrib_current,cast(null as DECIMAL(11,2)) as pre_tax_401k_contrib_prior,cast(null as DECIMAL(11,2)) as pre1987_ee_aftertax_contrib,cast(null as INTEGER) as prior_hce_indicator,cast(null as DATE) as processing_date,cast(null as VARCHAR(3)) as puerto_rico_resident,cast(null as DATE) as qdia_date,cast(null as VARCHAR(1)) as qdia_indicator,cast(null as DECIMAL(11,2)) as qdro_beneficary_actual_ssn,cast(null as VARCHAR(254)) as reduction_401k_option,cast(null as VARCHAR(25)) as related_participant_id,cast(null as VARCHAR(1)) as roll_account_type,cast(null as DECIMAL(11,2)) as roll_contribution_current_year,cast(null as DECIMAL(11,2)) as roll_contribution_prior_year,cast(null as DECIMAL(11,2)) as roth_deferral_contributions,cast(null as DATE) as roth_first_contribution_date,cast(null as DECIMAL(11,2)) as roth_iprr_contributions,cast(null as VARCHAR(254)) as roth_sma_account_number,cast(null as DECIMAL(11,2)) as roth_unrestricted_contrib,cast(null as VARCHAR(1)) as sdbo_hold_harmless,cast(null as VARCHAR(1)) as sma_fund_balance,cast(null as VARCHAR(9)) as social_security_number,cast(null as DECIMAL(4,3)) as source_adj_vest_percent,cast(null as DATE) as source_processing_date,cast(null as DATE) as spouse_consent_expiration_date,cast(null as DATE) as spouse_birth_date,cast(null as VARCHAR(30)) as spouse_name,cast(null as INTEGER) as suspension_months_ee_contrib,cast(null  as VARCHAR(13)) as employee_number_2,cast(null as INTEGER) as suspension_months_er_contrib,cast(null as INTEGER) as suspension_months_forf_realloc,cast(null as VARCHAR(3)) as tax_treaty_country_code,cast(null as DATE) as termination_notification_date,cast(null as VARCHAR(1)) as termination_reason_code,cast(null as INTEGER) as total_number_of_funds,cast(null as INTEGER) as trade_activity,cast(null as VARCHAR(254)) as very_important_person_indicat,cast(null as VARCHAR(1)) as withdrawal_restriction,cast(null as VARCHAR(1)) as withdrawal_restriction_reason,cast(null as DATE) as  last_crc_rate_chg_dt,cast(null as VARCHAR(2)) as term_stat_reason_code,cast(null AS VARCHAR(1)) as cntrbs_txd_by_st_flg,cast(null as DECIMAL(7,2)) as ee_cntrb_pty,cast(null as DECIMAL(7,2)) as ee_cntrb_ytd,cast('0.00' as DECIMAL(15,2)) as ytd_contributions,cast(null as VARCHAR(1)) as roth_catch_up_flag,cast(null as DECIMAL(11,2)) as rehire_accum_hours,cast(null as VARCHAR(1)) as rehire_ee_category,cast(null as DATE) as rehire_effective_date,cast(null as DATE) as rehire_last_change_date,cast(null as DECIMAL(16,2)) as loan_variable_loan_fee_amt,cast(null as VARCHAR(1)) as loan_variable_loan_fee_payor,cast(null as varchar(25)) as loan_fee_var_maint_payor_desc from super_omni_newr_particpantaccount_daily_ng_dat;")

    f950_rps_partcpnt_cef_data_ewr_df = spark.sql("select coalesce(part_client_id,-9999) as client_id,part_account_num as participant_id,concat('AE ',part_plan_number,part_account_num) as retirement_account_id, coalesce(part_plan_number,-9999) as plan_number, part_sys_key, part_agg_sys_key, part_acc_comp_code as part_acc_company_code, part_src_system as source_system, part_acc_prod_code, part_acc_prod_shrt_nm, part_acc_typ_code as participant_account_type_code,case when part_src_system = 'PREMIER' then  'Allocated Account' else  part_acc_type end as participant_account_type, part_acc_plan_code, part_acc_stat_code as participant_status_code,part_account_status as participant_status, cast(part_acc_stat_date as DATE) as part_acct_status_date, part_type, cast(part_acc_plan_entry_date as DATE) as plan_entry_date, cast(part_empl_termin_date as DATE) as termination_date, cast(part_hire_date as DATE) as employment_date, part_tin as participant_tin, part_tin_last4 as participant_tin_last_four, cast(null as VARCHAR(25)) as div_sub_id, cast(part_date_of_birth as DATE) as birth_date, cast(part_current_age as DECIMAL(7,2)) as attained_age, part_gender_code, part_gender as sex, part_person_flag,round(DATEDIFF(day,part_date_of_birth,current_date())/365.25 , 1) AS age, part_full_name as participant_name_raw,cast(null as VARCHAR(100)) as participant_name, part_first_name as participant_first_name, part_last_name as participant_last_name, part_middle_name, part_suffix_title, part_addr_line_01 as participant_address_line_1, part_addr_line_02 as participant_address_line_2, part_addr_line_03 as participant_address_line_3, part_addr_city as participant_address_city, part_addr_state as participant_address_state, part_addr_zip as participant_address_zip_code, part_addr_country as country_name, part_lob as part_line_of_business, part_roth_year, part_ytd_ee_contrib, part_ytd_er_contrib, part_post88_surender, part_payrole_location, part_auto_enrolled as auto_enrollment_indicator, default_enrolled_qdia, cast(part_hard_suspend_date as DATE) as suspension_date, part_email as email_address, part_phone, cast(part_years_of_service as Integer) as periods_of_continuous_service, cast(part_ytd_hours_worked as INTEGER),cast(null as VARCHAR(1)) as qdro_flag, cast(null as VARCHAR(1)) part_location_code, cast(part_rehire_date as DATE) as reinstatement_notify_date, part_employee_id as employee_number, part_catchup_eligible as participant_catchup_eligible, part_marital_status as federal_part_marital_status, part_hce_status as participant_hce_status, part_16b_status as flag_16B, part_installment_status as participant_installment_status, cast(null as VARCHAR(40)) as participant_account_type_desc, cast(null as INTEGER) as marital_status,cast(null as VARCHAR(10)) as part_acc_status_text,cast(null as VARCHAR(6)) as part_product_id,cast(null as INTEGER) as ee_contrib_401k_state_tax_flag,cast(null as DECIMAL(11,2)) as ee_contrib_401k_current_year,cast(null as DECIMAL(11,2)) as ee_contrib_401k_prior_year,cast(null as DATE) as eligibility_5500_date,cast(null as DATE) as account_inception_date,cast(null as VARCHAR(01)) as account_type,cast(null as DECIMAL(11,2)) as addl_high_outst_loan_balance,cast(null as VARCHAR(01)) as address_validity,cast(null as INTEGER) as advice_account_indicator,cast(null as VARCHAR(01)) as advice_account_rebal_freq,cast(null as INTEGER) as advice_target_message_1,cast(null as INTEGER) as advice_target_message_2,cast(null as INTEGER) as advice_target_message_3,cast(null as VARCHAR(02)) as alternate_taxability_state,cast(null as DATE) as alternate_vesting_date,cast(null as DECIMAL(11,2)) as annual_dist_amount,cast(null as DECIMAL(11,2)) as annual_salary,cast(null as DATE) as auto_enrollment_date,cast(null as VARCHAR(01)) as automatic_increase_flag,cast(null as VARCHAR(01)) as beneficiary_code,cast(null as VARCHAR(20)) as brokerage_account_number,cast(null as VARCHAR(10)) as client_pass_thru_identifier,cast(null as VARCHAR(10)) as client_status,cast(null as VARCHAR(10)) as code2,cast(null as DECIMAL(11,2)) as contribution_415_current,cast(null as DECIMAL(11,2)) as contribution_415_prior,cast(null as INTEGER) as death_benefit_percentage,cast(null as DATE) as death_date,cast(null as VARCHAR(01)) as default_deferral_flag, cast(null as VARCHAR(01)) as default_investment_flag,cast(null as DATE) as defer_date,cast(null as VARCHAR(04)) as deferral_grouping_id,cast(null as DATE) as demographic_effective_date,cast(null as DECIMAL(4,1)) as div_pass_thru_indicator,cast(null as DECIMAL(5,4)) as dividend_pass_thru_election,cast(null as DECIMAL(4,1)) as divid_pass_thru_election_pct,cast(null as DATE) as dollar5000_reached_date,cast(null as INTEGER) as ee_contrib_taxed_by_state,cast(null as INTEGER) as egtrra_target_message_id,cast(null as DATE) as eligibility_completion_date,cast(null as DATE) as eligibility_date,cast(null as VARCHAR(1)) as eligibility_exclusion,cast(null as DATE) as eligibility_reminder_date,cast(null as VARCHAR(01)) as eligible_for_bonus,cast(null as DATE) as eligible_for_distribution_date,cast(null as DECIMAL(11,2)) as elig_rollover_distributions,cast(null as VARCHAR(13)) as employee_number_2,cast(null as VARCHAR(13)) as alternate_account_number,cast(null as VARCHAR(01)) as employment_status_reason,cast(null as date) as enrollment_date,cast(null as DECIMAL(11,2)) as equity_wash_amount,cast(null as DECIMAL(11,2)) as er_after_tax,cast(null as DECIMAL(11,2)) as esop_diversification_shares,cast(null as DATE) as excess_trader_suspend_end_date,cast(null as VARCHAR(1)) as excess_trader_suspend_flag,cast(null as DATE) as excess_trader_susp_start_date,cast(null as VARCHAR(1)) as federal_w4p_form_status,cast(null as VARCHAR(1)) as financial_engins_prospect_code,cast(null as date) as first_contribution_date,cast(null as DATE) as first_default_contrib_date,cast(null as VARCHAR(3)) as foreign_country_code,cast(null as date) as free_look_end_date,cast(null as INTEGER) as gender,cast(null as VARCHAR(1)) as group_payment_status_flag,cast(null as INTEGER) as hce_indicator,cast(null as DECIMAL(11,2)) as high_loan_balance_amount,cast(null as INTEGER) as highly_compensated_ee_flag,cast(null as INTEGER) as hours_of_service,cast(null as INTEGER) as human_resouce_status_code,cast(null as DECIMAL(11,2)) as ilip_equity_wash_residual_amt,cast(null as DATE) as init_partial_term_dist_date,cast(null as DATE) as init_rollover_dist_date,cast(null as INTEGER) as inside_trading_16b_restrict_id,cast(null as INTEGER) as key_employee_indicator,cast(null as VARCHAR(3)) as language_print_preference,cast(null as DATE) as last_alloc_pct_change_date,cast(null as DATE) as last_contrib_rate_change_date,cast(null as DECIMAL(17,2)) as last_contribution_amt_gross,cast(null as DATE) as last_contribution_date,cast(null as DATE) as last_hardship_withdrawal_date,cast(null as DATE) as last_loan_default_date,cast(null as DATE) as last_plan_to_plan_transf_date,cast(null as DATE) as last_transfer_date,cast(null as DATE) as leave_of_absense_end_date,cast(null as DECIMAL(11,2)) as lifetime_dsc_amount,cast(null as DECIMAL(11,2)) as managed_acct_salary_at_enroll,cast(null as VARCHAR(5)) as match_payroll_generic_grouping,cast(null as VARCHAR(1)) as min_distrib_begin_time_option,cast(null as VARCHAR(1)) as min_distrib_calculation_method,cast(null as DATE) as min_distrib_eligibility_date,cast(null as VARCHAR(1)) as min_distrib_suppress_option,cast(null as DATE) as mva_charged_to_date,cast(null as DECIMAL(11,2)) as net_401k_elective_deferrals,cast(null as DATE) as next_rebalance_date,cast(null as VARCHAR(10)) as nonqual_ind,cast(null as VARCHAR(80)) as old_advice_account,cast(null as INTEGER) as oracle_plan_rule_id,cast(null as VARCHAR(1)) as override_withholding,cast(null as DECIMAL(11,2)) as override_withholding_amount,cast(null as DECIMAL(5,4)) as override_withholding_pct,cast(null as VARCHAR(4)) as  part_suffix,cast(null as VARCHAR(1)) as participant_16b_status,cast('INFORCE' as VARCHAR(10)) as participant_account_status_desc,cast(null as VARCHAR(40)) as participant_address_line_4,cast(null as VARCHAR(13)) as participant_employee_id,cast(null as date) as participant_fe_end_date,cast(null as DATE) as participant_fe_start_date,cast(null as INTEGER) as participant_gender,cast(null as INTEGER) as participant_gender_code,cast(null as INTEGER) as participant_marital_status,cast(null as VARCHAR(40)) as participant_name_formatted,cast(null as VARCHAR(30)) as participant_name_protect,cast(null as VARCHAR(1)) as participant_person_flag,part_qdro_status as participant_qdro_status,cast(null as VARCHAR(3)) as pay_group_id,cast(null as VARCHAR(1)) as payroll_frequency,cast(null as VARCHAR(8)) as plan_reference_key,cast(null as DECIMAL(15,2)) as plan_year_compensation_current,cast(null as VARCHAR(2)) as group_iv_id,cast(null as DECIMAL(15,2)) as plan_year_compensation_prior,cast(null as DECIMAL(11,2)) as post1986_ee_aftertax_contrib,cast(null as DECIMAL(11,2)) as pre_tax_401k_contrib_current,cast(null as DECIMAL(11,2)) as pre_tax_401k_contrib_prior,cast(null as DECIMAL(11,2)) as pre1987_ee_aftertax_contrib,cast(null as INTEGER) as prior_hce_indicator,cast(null as DATE) as processing_date,cast(null as VARCHAR(3)) as puerto_rico_resident,cast(null as DATE) as qdia_date,cast(null as VARCHAR(1)) as qdia_indicator,cast(null as DECIMAL(11,2)) as qdro_beneficary_actual_ssn,cast(null as VARCHAR(254)) as reduction_401k_option,cast(null as VARCHAR(25)) as related_participant_id,cast(null as VARCHAR(1)) as roll_account_type,cast(null as DECIMAL(11,2)) as roll_contribution_current_year,cast(null as DECIMAL(11,2)) as roll_contribution_prior_year,cast(null as DECIMAL(11,2)) as roth_deferral_contributions,cast(null as DATE) as roth_first_contribution_date,cast(NULL as Decimal(11,2)) as roth_cost_basis ,cast(null as DECIMAL(11,2)) as roth_iprr_contributions,cast(null as VARCHAR(254)) as roth_sma_account_number,cast(null as DECIMAL(11,2)) as roth_unrestricted_contrib,cast(null as VARCHAR(1)) as sdbo_hold_harmless,cast(null as VARCHAR(1)) as sma_fund_balance,cast(null as VARCHAR(9)) as social_security_number,cast(null as DECIMAL(4,3)) as source_adj_vest_percent,cast( date_format(to_date(batch_date, 'yyyyMMdd'), 'yyyy-MM-dd') as date) as source_cycle_date,cast(null as DATE) as source_processing_date,cast(null as DATE) as spouse_consent_expiration_date,cast(null as DATE) as spouse_birth_date,cast(null as VARCHAR(30)) as spouse_name,cast(null as INTEGER) as suspension_months_ee_contrib,cast(null as INTEGER) as suspension_months_er_contrib,cast(null as INTEGER) as suspension_months_forf_realloc,cast(null as VARCHAR(3)) as tax_treaty_country_code,cast(null as DATE) as termination_notification_date,cast(null as VARCHAR(1)) as termination_reason_code,cast(null as INTEGER) as total_number_of_funds,cast(null as INTEGER) as trade_activity,cast(null as VARCHAR(254)) as very_important_person_indicat,cast(null as VARCHAR(1)) as withdrawal_restriction,cast(null as VARCHAR(1)) as withdrawal_restriction_reason,cast(null as DATE) as  last_crc_rate_chg_dt,cast(null as VARCHAR(2)) as term_stat_reason_code,cast(null AS VARCHAR(1)) as cntrbs_txd_by_st_flg,cast(null as DECIMAL(7,2)) as ee_cntrb_pty,cast(null as DECIMAL(7,2)) as ee_cntrb_ytd,cast('0.00' as DECIMAL(15,2)) as ytd_contributions,cast(null as VARCHAR(1)) as roth_catch_up_flag, cast(null as DECIMAL(11,2)) as rehire_accum_hours,cast(null as VARCHAR(1)) as rehire_ee_category,cast(null as DATE) as rehire_effective_date,cast(null as DATE) as rehire_last_change_date, cast(null as DECIMAL(16,2)) as loan_variable_loan_fee_amt,cast(null as VARCHAR(1)) as loan_variable_loan_fee_payor,cast(null as varchar(25)) as loan_fee_var_maint_payor_desc from f950_rps_partcpnt_cef_data_ewr_dat;")

    nw00paap_nlarc_prdps_partact_pdab_data_df = spark.sql("select coalesce(nullif(trim(n.part_acct_client_id),'') ,nullif(trim(q1.client_id),''),'-9999') as client_id,coalesce(n.plan_number,lmia.plan_number,-9999) as plan_number, coalesce(n.participant_acc_number,lmia.policy_number,-9999) as participant_id,  coalesce(n.participant_acc_number,-9999) as retirement_account_id,coalesce(n.part_acc_company_code,lmia.company_code) as part_acc_company_code , coalesce(n.part_acc_source_system,lmia.source_system) as source_system, n.part_product_code as part_product_id, n.part_acc_plan_code, n.part_acc_status as participant_status, n.part_acc_status_text, cast(n.part_acct_status_date as DATE), n.part_type, cast(n.part_acc_plan_entry_date as DATE) as plan_entry_date, n.participant_tin, n.participant_tin_last_4 as participant_tin_last_four,round(DATEDIFF(day,n.participant_dob,current_date())/365.25 , 1) AS age,n.plan_reference_key, cast(n.participant_dob as DATE) as birth_date, cast(n.part_age as DECIMAL(7,2)) as attained_age, n.part_gender_code,cast(null as VARCHAR(25)) as div_sub_id, n.part_gender_text as sex, n.part_person_flag, n.part_full_name as participant_name_raw,cast(null as VARCHAR(100)) as participant_name, n.part_first_name as participant_first_name, n.part_last_name participant_last_name, n.part_suffix, n.part_addr_line1 as participant_address_line_1, n.part_addr_line2 as participant_address_line_2, n.part_addr_line3 as participant_address_line_3, n.part_addr_city as participant_address_city, n.part_addr_state as participant_address_state, n.part_addr_postal_code as participant_address_zip_code, n.part_addr_country as country_name, n.part_lob as part_line_of_business, cast(lmia.process_date as DATE) as processing_date, lmia.soc_sec_no as social_security_number, cast(null as INTEGER) as marital_status, cast(null as INTEGER) as ee_contrib_401k_state_tax_flag, cast(null as DECIMAL(11,2)) as ee_contrib_401k_current_year, cast(null as DECIMAL(11,2)) as ee_contrib_401k_prior_year, cast(null as DATE) as eligibility_5500_date, cast(null as DATE) as account_inception_date, cast(null as VARCHAR(01)) as account_type, cast(null as DECIMAL(11,2)) as addl_high_outst_loan_balance, cast(null as VARCHAR(01)) as address_validity, cast(null as INTEGER) as advice_account_indicator, cast(null as VARCHAR(01)) as advice_account_rebal_freq, cast(null as INTEGER) as advice_target_message_1, cast(null as INTEGER) as advice_target_message_2, cast(null as INTEGER) as advice_target_message_3, cast(null as VARCHAR(02)) as alternate_taxability_state, cast(null as DATE) as alternate_vesting_date, cast(null as DECIMAL(11,2)) as annual_dist_amount, cast(null as DECIMAL(11,2)) as annual_salary, cast(null as DATE) as auto_enrollment_date, cast(null as VARCHAR(10)) as auto_enrollment_indicator, cast(null as VARCHAR(01)) as automatic_increase_flag, cast(null as VARCHAR(01)) as beneficiary_code, cast(null as VARCHAR(20)) as brokerage_account_number, cast(null as VARCHAR(10)) as client_pass_thru_identifier, cast(null as VARCHAR(10)) as client_status, cast(null as VARCHAR(10)) as code2, cast(null as DECIMAL(11,2)) as contribution_415_current, cast(null as DECIMAL(11,2)) as contribution_415_prior, cast(null as INTEGER) as death_benefit_percentage, cast(null as DATE) as death_date, cast(null as VARCHAR(01)) as default_deferral_flag, cast(null as VARCHAR(1)) as default_enrolled_qdia, cast(null as VARCHAR(01)) as default_investment_flag, cast(null as DATE) as defer_date, cast(null as VARCHAR(04)) as deferral_grouping_id, cast(null as DATE) as demographic_effective_date, cast(null as DECIMAL(4,1)) as div_pass_thru_indicator, cast(null as DECIMAL(5,4)) as dividend_pass_thru_election, cast(null as DECIMAL(4,1)) as divid_pass_thru_election_pct, cast(null as DATE) as dollar5000_reached_date, cast(null as INTEGER) as ee_contrib_taxed_by_state, cast(null as INTEGER) as egtrra_target_message_id, cast(null as DATE) as eligibility_completion_date, cast(null as DATE) as eligibility_date, cast(null as VARCHAR(01)) as eligibility_exclusion, cast(null as DATE) as eligibility_reminder_date, cast(null as VARCHAR(01)) as eligible_for_bonus, cast(null as DATE) as eligible_for_distribution_date, cast(null as DECIMAL(11,2)) as elig_rollover_distributions, cast(null as VARCHAR(80)) as email_address, cast(null as VARCHAR(40)) as employee_number, cast(null as VARCHAR(13)) as employee_number_2, cast(null as VARCHAR(13)) as alternate_account_number, cast(null as DATE) as employment_date, cast(null as VARCHAR(01)) as employment_status_reason, cast(null as date) as enrollment_date, cast(null as DECIMAL(11,2)) as equity_wash_amount, cast(null as DECIMAL(11,2)) as er_after_tax, cast(null as DECIMAL(11,2)) as esop_diversification_shares, cast(null as DATE) as excess_trader_suspend_end_date, cast(null as VARCHAR(1)) as excess_trader_suspend_flag, cast(null as DATE) as excess_trader_susp_start_date, cast(null as VARCHAR(01)) as federal_part_marital_status, cast(null as VARCHAR(1)) as federal_w4p_form_status, cast(null as VARCHAR(1)) as financial_engins_prospect_code, cast(null as date) as first_contribution_date, cast(null as DATE) as first_default_contrib_date, cast(null as VARCHAR(1)) as flag_16B, cast(null as VARCHAR(3)) as foreign_country_code, cast(null as date) as free_look_end_date, cast(null as INTEGER) as gender, cast(null as VARCHAR(1)) as group_payment_status_flag, cast(null as INTEGER) as hce_indicator, cast(null as DECIMAL(11,2)) as high_loan_balance_amount, cast(null as INTEGER) as highly_compensated_ee_flag, cast(null as INTEGER) as hours_of_service, cast(null as INTEGER) as human_resouce_status_code, cast(null as DECIMAL(11,2)) as ilip_equity_wash_residual_amt, cast(null as DATE) as init_partial_term_dist_date, cast(null as DATE) as init_rollover_dist_date, cast(null as INTEGER) as inside_trading_16b_restrict_id, cast(null as INTEGER) as key_employee_indicator, cast(null as VARCHAR(3)) as language_print_preference, cast(null as DATE) as last_alloc_pct_change_date, cast(null as DATE) as last_contrib_rate_change_date, cast(lmia.gross_amount as DECIMAL(17,2)) as last_contribution_amt_gross, cast(null as DATE) as last_contribution_date, cast(null as DATE) as last_hardship_withdrawal_date, cast(null as DATE) as last_loan_default_date, cast(null as DATE) as last_plan_to_plan_transf_date, cast(null as DATE) as last_transfer_date, cast(null as DATE) as leave_of_absense_end_date, cast(null as DECIMAL(11,2)) as lifetime_dsc_amount, cast(null as DECIMAL(11,2)) as managed_acct_salary_at_enroll, cast(null as VARCHAR(5)) as match_payroll_generic_grouping, cast(null as VARCHAR(1)) as min_distrib_begin_time_option, cast(null as VARCHAR(1)) as min_distrib_calculation_method, cast(null as DATE) as min_distrib_eligibility_date, cast(null as VARCHAR(1)) as min_distrib_suppress_option, cast(null as DATE) as mva_charged_to_date, cast(null as DECIMAL(11,2)) as net_401k_elective_deferrals, cast(null as DATE) as next_rebalance_date, cast(null as VARCHAR(10)) as nonqual_ind, cast(null as VARCHAR(80)) as old_advice_account, cast(null as INTEGER) as oracle_plan_rule_id, cast(null as VARCHAR(1)) as override_withholding, cast(null as DECIMAL(11,2)) as override_withholding_amount, cast(null as DECIMAL(5,4)) as override_withholding_pct, cast(null as VARCHAR(2)) as part_acc_prod_code, cast(null as VARCHAR(20)) as part_acc_prod_shrt_nm, cast(null as VARCHAR(24)) as part_agg_sys_key, cast(null as VARCHAR(4)) as part_location_code, cast(null as VARCHAR(25)) as part_middle_name, cast(null as VARCHAR(5)) as part_payrole_location, cast(null as VARCHAR(32)) as part_phone, cast(null as VARCHAR(15)) as part_post88_surender, cast(null as VARCHAR(4)) as part_roth_year, cast(null as VARCHAR(10)) as part_suffix_title, cast(null as VARCHAR(13)) as part_sys_key, cast(null as VARCHAR(15)) as part_ytd_ee_contrib, cast(null as VARCHAR(15)) as part_ytd_er_contrib, cast(null as INTEGER) as part_ytd_hours_worked, cast(null as VARCHAR(1)) as participant_16b_status, case when n.part_acc_status in ('A','E','Z') then 'ACTIVE' when n.part_acc_status in ('N','F') then 'INACTIVE' when n.part_acc_status ='W'  then 'WAITING' end as participant_account_status_desc, cast(null as VARCHAR(55)) as participant_account_type, cast('ALLOC' as VARCHAR(30)) as participant_account_type_code, cast('100% Allocated Account' as VARCHAR(30)) as participant_account_type_desc, cast(null as VARCHAR(40)) as participant_address_line_4, cast(null as VARCHAR(1)) as participant_catchup_eligible, cast(null as VARCHAR(13)) as participant_employee_id, cast(null as date) as participant_fe_end_date, cast(null as DATE) as participant_fe_start_date, cast(null as INTEGER) as participant_gender, cast(null as INTEGER) as participant_gender_code, cast(null as VARCHAR(1)) as participant_hce_status, cast(null as VARCHAR(1)) as participant_installment_status, cast(null as INTEGER) as participant_marital_status, cast(null as VARCHAR(40)) as participant_name_formatted, cast(null as VARCHAR(30)) as participant_name_protect, cast(null as VARCHAR(1)) as participant_person_flag, cast(null as VARCHAR(1)) as participant_qdro_status, cast(n.part_acc_status as VARCHAR(10)) as participant_status_code, cast(null as VARCHAR(3)) as pay_group_id, cast(null as VARCHAR(1)) as payroll_frequency, cast(null as INTEGER) as periods_of_continuous_service, cast(null as DECIMAL(15,2)) as plan_year_compensation_current, cast(null as VARCHAR(2)) as group_iv_id, cast(null as DECIMAL(15,2)) as plan_year_compensation_prior, cast(null as DECIMAL(11,2)) as post1986_ee_aftertax_contrib, cast(null as DECIMAL(11,2)) as pre_tax_401k_contrib_current, cast(null as DECIMAL(11,2)) as pre_tax_401k_contrib_prior, cast(null as DECIMAL(11,2)) as pre1987_ee_aftertax_contrib, cast(null as INTEGER) as prior_hce_indicator, cast(null as VARCHAR(3)) as puerto_rico_resident, cast(null as DATE) as qdia_date, cast(null as VARCHAR(1)) as qdia_indicator, cast(null as DECIMAL(11,2)) as qdro_beneficary_actual_ssn, cast(null as VARCHAR(1)) as qdro_flag, cast(null as VARCHAR(254)) as reduction_401k_option, cast(null as DATE) as reinstatement_notify_date, cast(null as VARCHAR(25)) as related_participant_id, cast(null as VARCHAR(1)) as roll_account_type, cast(null as DECIMAL(11,2)) as roll_contribution_current_year, cast(null as DECIMAL(11,2)) as roll_contribution_prior_year, cast(null as DECIMAL(11,2)) as roth_deferral_contributions,cast(NULL as Decimal(11,2)) as roth_cost_basis, cast(null as DATE) as roth_first_contribution_date, cast(null as DECIMAL(11,2)) as roth_iprr_contributions, cast(null as VARCHAR(254)) as roth_sma_account_number, cast(null as DECIMAL(11,2)) as roth_unrestricted_contrib, cast(null as VARCHAR(1)) as sdbo_hold_harmless, cast(null as VARCHAR(1)) as sma_fund_balance, cast(null as DECIMAL(4,3)) as source_adj_vest_percent, cast( date_format(to_date(n.batch_date, 'yyyyMMdd'), 'yyyy-MM-dd') as date) as source_cycle_date, cast(null as DATE) as source_processing_date, cast(null as DATE) as spouse_consent_expiration_date, cast(null as DATE) as spouse_birth_date, cast(null as VARCHAR(30)) as spouse_name, cast(null as DATE) as suspension_date, cast(null as INTEGER) as suspension_months_ee_contrib, cast(null as INTEGER) as suspension_months_er_contrib, cast(null as INTEGER) as suspension_months_forf_realloc, cast(null as VARCHAR(3)) as tax_treaty_country_code, cast(null as DATE) as termination_date, cast(null as DATE) as termination_notification_date, cast(null as VARCHAR(1)) as termination_reason_code, cast(null as INTEGER) as total_number_of_funds, cast(null as INTEGER) as trade_activity, cast(null as VARCHAR(254)) as very_important_person_indicat, cast(null as VARCHAR(1)) as withdrawal_restriction, cast(null as VARCHAR(1)) as withdrawal_restriction_reason,cast(null as DATE) as  last_crc_rate_chg_dt,cast(null as VARCHAR(2)) as term_stat_reason_code,cast(null AS VARCHAR(1)) as cntrbs_txd_by_st_flg,cast(null as DECIMAL(7,2)) as ee_cntrb_pty,cast(null as DECIMAL(7,2)) as ee_cntrb_ytd,cast('0.00' as DECIMAL(15,2)) as ytd_contributions,cast(null as VARCHAR(1)) as roth_catch_up_flag,cast(null as DECIMAL(11,2)) as rehire_accum_hours,cast(null as VARCHAR(1)) as rehire_ee_category,cast(null as DATE) as rehire_effective_date,cast(null as DATE) as rehire_last_change_date, cast(null as DECIMAL(16,2)) as loan_variable_loan_fee_amt,cast(null as VARCHAR(1)) as loan_variable_loan_fee_payor,cast(null as varchar(25)) as loan_fee_var_maint_payor_desc from nw00paap_nlarc_prdps_partact_pdab_data as n Left OUTER JOIN nw00paap_nlarc_prdps_pdab_lmia_data as lmia ON n.participant_acc_number=lmia.policy_number and n.plan_number=lmia.plan_number left outer join nw00paap_nlarc_prdps_plan_pdab_data q1 on n.plan_number=q1.plan_number")

    exn_xxewre01_xxewrptd_jb_df = spark.sql("SELECT coalesce(client_id,-9999) as client_id,coalesce(plan_number,-9999) as plan_number,concat(plan_number,'~',part_number) as retirement_account_id,coalesce(part_number,-9999) as participant_id,cast(401k_ee_contributions_state_tax_flag as integer) as ee_contrib_401k_state_tax_flag,cast(401k_employee_contribution_current_year as DECIMAL(11,2)) as ee_contrib_401k_current_year,cast(401k_employee_contribution_prior_year as DECIMAL(11,2)) as ee_contrib_401k_prior_year,cast(5500_eligibility_date as date) as eligibility_5500_date,cast(account_inception_date as date) as account_inception_date,account_type,cast(addl_highest_outstanding_loan_balance as DECIMAL(11,2)) as addl_high_outst_loan_balance,address_validity,cast(advice_account_indicator as integer) as advice_account_indicator,advice_account_rebalance_frequency as advice_account_rebal_freq,round(DATEDIFF(day,date_of_birth,current_date())/365.25 , 1) AS age,cast(advice_target_message_1 as INTEGER) as advice_target_message_1,cast(advice_target_message_2 as INTEGER) as advice_target_message_2,cast(advice_target_message_3 as INTEGER) as advice_target_message_3,alternate_taxability_state,cast(annual_dist_amount as DECIMAL(11,2)) as annual_dist_amount,cast(annual_salary as DECIMAL(11,2)) as annual_salary,cast(attained_age as DECIMAL(7,2)) as attained_age,cast(auto_enrollment_date as date) as auto_enrollment_date,automatic_increase_flag,beneficiary_code,coalesce(div_sub_id,null) as div_sub_id,brokerage_account_number,client_pass_thru_identifier,client_status,cast(contribution_415_current as DECIMAL(11,2)) as contribution_415_current,cast(contribution_415_prior as DECIMAL(11,2)) as contribution_415_prior,country_name,cast(date_5000_reached as date) as dollar5000_reached_date,cast(date_of_alternate_vesting as date) as alternate_vesting_date,cast(date_of_birth as date) as birth_date,cast(date_of_death as date) as death_date,cast(date_of_employment as date) as employment_date,cast(date_of_last_alloc_percent_change as date) as last_alloc_pct_change_date,cast(date_of_last_transfer as date) as last_transfer_date,cast(date_of_plan_entry as date) as plan_entry_date,cast(date_of_suspension as date) as suspension_date,cast(date_of_termination as date) as termination_date,cast(death_benefit_percentage as integer) as death_benefit_percentage,default_deferral_flag as default_deferral_flag,default_investment_flag as default_investment_flag,cast(defer_date as date) as defer_date,deferral_grouping_id,cast(demographic_effective_date as date) as demographic_effective_date,cast(div_pass_thru_indicator as decimal(4,1)) as div_pass_thru_indicator,cast(dividend_pass_thru_election as DECIMAL(5,4)) as dividend_pass_thru_election,cast(dividend_pass_thru_election_percent as DECIMAL(4,1)) as divid_pass_thru_election_pct,cast(egtrra_target_message_id as INTEGER) as egtrra_target_message_id,cast(eligibility_completion_date as date) as eligibility_completion_date,eligibility_exclusion,cast(eligibility_reminder_date as date) as eligibility_reminder_date,eligible_for_bonus,cast(eligible_for_distribution_date as date) as eligible_for_distribution_date,cast(eligible_rollover_distributions as DECIMAL(11,2)) as elig_rollover_distributions,e_mail_address as email_address,employee_number,employee_number_2,employment_status_reason,cast(equity_wash_amount as DECIMAL(11,2)) as equity_wash_amount,cast(er_after_tax as DECIMAL(11,2)) as er_after_tax,cast(esop_diversification_shares as DECIMAL(11,2)) as esop_diversification_shares,cast(excess_trader_suspend_end_date as date) as excess_trader_suspend_end_date,excess_trader_suspend_flag,cast(excess_trader_suspend_start_date as date) as excess_trader_susp_start_date,federal_participant_marital_status as federal_part_marital_status,federal_w4p_form_status,financial_engins_prospect_code,first_contribution_date,cast(first_default_contribution_date as date) as first_default_contrib_date, participant_16b_status,foreign_country_code,group_payment_status_flag,cast(hce_indicator as integer) as hce_indicator,cast(high_loan_balance_amount as DECIMAL(11,2)) as high_loan_balance_amount,cast(human_resouce_status_code as integer) as human_resouce_status_code,cast(ilip_equity_wash_residual_amount as DECIMAL(11,2)) as ilip_equity_wash_residual_amt,cast(init_partial_term_dist_date as date) as init_partial_term_dist_date,cast(init_rollover_dist_date as date) as init_rollover_dist_date,grp_iv_id as group_iv_id,cast(key_employee_indicator as integer) as key_employee_indicator,language_print_preference,cast(last_contrib_rate_change_date as date) as last_contrib_rate_change_date,cast(last_contribution_date as date) as last_contribution_date,cast(last_hardship_withdrawal_date as date) as last_hardship_withdrawal_date,cast(last_loan_default_date as date) as last_loan_default_date,cast(leave_of_absense_end_date as date) as leave_of_absense_end_date,cast(lifetime_dsc_amount as DECIMAL(11,2)) as lifetime_dsc_amount,cast(managed_account_salary_at_enrollment as DECIMAL(11,2)) as managed_acct_salary_at_enroll,match_payroll_generic_grouping,minimum_distribution_begin_time_option as min_distrib_begin_time_option,minimum_distribution_calculation_method as min_distrib_calculation_method,cast(minimum_distribution_eligibility_date as date) as min_distrib_eligibility_date,minimum_distribution_suppress_option as min_distrib_suppress_option,cast(mva_charged_to_date as date) as mva_charged_to_date,cast(net_401k_elective_deferrals as DECIMAL(11,2)) as net_401k_elective_deferrals,cast(next_rebalance_date as date) as next_rebalance_date,nonqual_ind,old_advice_account,cast(oracle_plan_rule_id as integer) as oracle_plan_rule_id,override_withholding,cast(override_withholding_amount as DECIMAL(11,2)) as override_withholding_amount,cast(override_withholding_percentage as DECIMAL(5,4)) as override_withholding_pct,participant_address_city,participant_address_line_3,participant_address_line_4,participant_address_state,participant_address_zip_code,cast(participant_fe_end_date as date) as participant_fe_end_date,cast(participant_fe_start_date as date) as participant_fe_start_date,participant_first_name,participant_last_name,participant_name_raw,participant_name as participant_name,participant_name_formatted,participant_status,pay_group_id,payroll_frequency, cast(periods_of_continuous_service as integer) as periods_of_continuous_service,cast(post_1986_employee_aftertax_contributions as DECIMAL(11,2)) as post1986_ee_aftertax_contrib,cast(pre_tax_401k_contribution_current as DECIMAL(11,2)) as pre_tax_401k_contrib_current,cast(pre_tax_401k_contribution_prior as DECIMAL(11,2)) as pre_tax_401k_contrib_prior,cast(pre_1987_employee_aftertax_contributions as DECIMAL(11,2)) as pre1987_ee_aftertax_contrib,cast(prior_hce_indicator as integer) as prior_hce_indicator,puerto_rico_resident,cast(qdia_date as date) as qdia_date, qdia_indicator ,cast(qdro_beneficary_actual_ssn as DECIMAL(11,2)) as qdro_beneficary_actual_ssn,qdro_flag,reduction_401k_option,cast(reinstatement_notify_date as date) as reinstatement_notify_date,related_participant_id,cast(roll_contribution_current_year as DECIMAL(11,2)) as roll_contribution_current_year,cast(roll_contribution_prior_year as DECIMAL(11,2)) as roll_contribution_prior_year,cast(roth_cost_basis as Decimal(11,2)) as roth_cost_basis ,cast(roth_deferral_contributions as DECIMAL(11,2)) as roth_deferral_contributions,cast(roth_first_contribution_date as date) as roth_first_contribution_date,cast(roth_iprr_contributions as decimal(11,2)) as roth_iprr_contributions,roth_sma_account_number,cast(null as decimal(11,2)) as roth_unrestricted_contrib,sdbo_hold_harmless,case  when sex='1' then 'MALE' when sex='2' then 'FEMALE' end as sex ,sma_fund_balance,cast(spousal_consent_expiration_date as date) as spouse_consent_expiration_date,cast(spouse_birth_date as date) as spouse_birth_date,spouse_name,cast(suspension_months_ee_contributions as INTEGER) as suspension_months_ee_contrib,cast(suspension_months_er_contributions as INTEGER) as suspension_months_er_contrib,cast(suspension_months_forfeiture_reallocations as INTEGER) as suspension_months_forf_realloc,tax_treaty_country_code,cast(termination_notification_date as date) as termination_notification_date,termination_reason_code,cast(total_number_of_funds as INTEGER) as total_number_of_funds,cast(trade_activity as integer) as trade_activity,very_important_person_indicator as very_important_person_indicat,withdrawal_restriction,withdrawal_restriction_reason,'VRP-SP' as source_system,cast(null as VARCHAR(10)) as part_acc_status_text,cast(null as VARCHAR(6)) as part_product_id,cast(null as VARCHAR(11)) as part_type,cast(null as VARCHAR(1)) as flag_16B,cast(null as DECIMAL(17,2)) as last_contribution_amt_gross,cast(null as VARCHAR(6)) as part_acc_plan_code,cast(null as date) as enrollment_date,cast(null as date) as free_look_end_date,cast(null as VARCHAR(2)) as part_acc_prod_code,cast(null as VARCHAR(20)) as part_acc_prod_shrt_nm,cast(null as DATE) as part_acct_status_date,cast(null as VARCHAR(24)) as part_agg_sys_key,case when sex='1' then 'M' when sex='2' then 'F' end as part_gender_code,cast(null as VARCHAR(3)) as part_line_of_business,cast(null as VARCHAR(4)) as part_location_code,cast(null as VARCHAR(25)) as part_middle_name,cast(null as VARCHAR(5)) as part_payrole_location,cast(null as VARCHAR(1)) as part_person_flag,cast(null as VARCHAR(32)) as part_phone,cast(null as VARCHAR(15)) as part_post88_surender,year(part_roth_first_contribution_date) as part_roth_year,cast(null as VARCHAR(4)) as  part_suffix,cast(null as VARCHAR(10)) as part_suffix_title,cast(null as VARCHAR(13)) as part_sys_key,cast(null as VARCHAR(15)) as part_ytd_ee_contrib,cast(null as VARCHAR(15)) as part_ytd_er_contrib,cast(null as VARCHAR(3)) as part_acc_company_code,cast(null as VARCHAR(55)) as participant_account_type,cast(participant_status as VARCHAR(10)) as participant_status_code,cast(null as VARCHAR(8)) as plan_reference_key,cast(null as VARCHAR(9)) as social_security_number,cast(source_cycle_date as date) as source_cycle_date,cast(in_tr_rest_flag as integer) as inside_trading_16b_restrict_id,last_crc_rate_chg_dt,term_stat_reason_code,cntrbs_txd_by_st_flg,cast(ee_cntrb_pty as decimal(7,2)) as ee_cntrb_pty,cast(ee_cntrb_ytd as decimal(7,2)) as ee_cntrb_ytd,date_of_eligibility as eligibility_date,cast(ytd_contributions as DECIMAL(15,2)) as ytd_contributions, cast(null as VARCHAR(10)) as  auto_enrollment_indicator, cast(null as INTEGER) as  hours_of_service, cast(null as VARCHAR(30)) as  participant_account_type_code, cast(null as VARCHAR(40)) as  participant_account_type_desc, cast(null as VARCHAR(1)) as  participant_catchup_eligible, cast(null as VARCHAR(255)) as  participant_address_line_1, cast(null as VARCHAR(255)) as  participant_address_line_2,  case when qdia_indicator='1' then 'Y' else 'N' end  as  default_enrolled_qdia, cast(null as INTEGER) as  part_ytd_hours_worked, cast(null as VARCHAR(1)) as  participant_hce_status, cast(null as VARCHAR(1)) as  participant_installment_status, cast(part_number as VARCHAR(17)) as  participant_tin, cast(right(trim(part_number),4) as VARCHAR(4)) as  participant_tin_last_four, cast(null as INTEGER) as  marital_status, cast(null as VARCHAR(10)) as  code2, cast(null as INTEGER) as  ee_contrib_taxed_by_state, cast(null as VARCHAR(13)) as  alternate_account_number, cast(null as INTEGER) as  gender, cast(null as INTEGER) as  highly_compensated_ee_flag, cast(null as DATE) as  last_plan_to_plan_transf_date, case when participant_status<=16 then 'ACTIVE' when participant_status>=20 and participant_status<=35 then 'INACTIVE' end  as  participant_account_status_desc, cast(null as VARCHAR(13)) as  participant_employee_id, cast(null as INTEGER) as  participant_gender, cast(null as INTEGER) as  participant_gender_code, case when federal_participant_marital_status ='0' then 'UNKNOWN' when  federal_participant_marital_status ='1' then 'Single' when federal_participant_marital_status ='2' then 'Married' when federal_participant_marital_status ='3' then 'Married-Filing-Separately' when federal_participant_marital_status ='4' then 'Head-Of-Household' end as  participant_marital_status, cast(null as VARCHAR(30)) as  participant_name_protect, cast(null as VARCHAR(1)) as  participant_person_flag, cast(null as VARCHAR(1)) as  participant_qdro_status, cast(null as DECIMAL(15,2)) as  plan_year_compensation_current, cast(null as DECIMAL(15,2)) as  plan_year_compensation_prior, cast(null as DATE) as  processing_date, cast(null as VARCHAR(1)) as  roll_account_type, cast(null as DECIMAL(4,3)) as  source_adj_vest_percent, cast(null as DATE) as  source_processing_date,roth_catch_up_flag, cast(rehire_accum_hours as DECIMAL(11,2)) as rehire_accum_hours, rehire_ee_category, cast(rehire_effective_date as DATE) as rehire_effective_date, cast(rehire_last_change_date as DATE) as rehire_last_change_date,cast(loan_variable_loan_fee_amt as DECIMAL(16,2)) as  loan_variable_loan_fee_amt,loan_variable_loan_fee_payor,case when loan_variable_loan_fee_payor='S' then 'Sponsor Paid' when loan_variable_loan_fee_payor='P' then 'Participant Paid' else 'UNKNOWN' end as loan_fee_var_maint_payor_desc  FROM exn_xxewre01_xxewrptd_jb;")

    exn_xxewre01_xxewrptd_ng_df = spark.sql("SELECT coalesce(client_id,-9999) as client_id,coalesce(plan_number,-9999) as plan_number,concat(plan_number,'~',part_number) as retirement_account_id,coalesce(part_number,-9999) as participant_id,cast(401k_ee_contributions_state_tax_flag as integer) as ee_contrib_401k_state_tax_flag,cast(401k_employee_contribution_current_year as DECIMAL(11,2)) as ee_contrib_401k_current_year,cast(401k_employee_contribution_prior_year as DECIMAL(11,2)) as ee_contrib_401k_prior_year,cast(5500_eligibility_date as date) as eligibility_5500_date,cast(account_inception_date as date) as account_inception_date,account_type,cast(addl_highest_outstanding_loan_balance as DECIMAL(11,2)) as addl_high_outst_loan_balance,address_validity,cast(advice_account_indicator as integer) as advice_account_indicator,advice_account_rebalance_frequency as advice_account_rebal_freq,round(DATEDIFF(day,date_of_birth,current_date())/365.25 , 1) AS age,cast(advice_target_message_1 as INTEGER) as advice_target_message_1,cast(advice_target_message_2 as INTEGER) as advice_target_message_2,cast(advice_target_message_3 as INTEGER) as advice_target_message_3,alternate_taxability_state,cast(annual_dist_amount as DECIMAL(11,2)) as annual_dist_amount,cast(annual_salary as DECIMAL(11,2)) as annual_salary,cast(attained_age as DECIMAL(7,2)) as attained_age,cast(auto_enrollment_date as date) as auto_enrollment_date,automatic_increase_flag,beneficiary_code,coalesce(div_sub_id,null) as div_sub_id,brokerage_account_number,client_pass_thru_identifier,client_status,cast(contribution_415_current as DECIMAL(11,2)) as contribution_415_current,cast(contribution_415_prior as DECIMAL(11,2)) as contribution_415_prior,country_name,cast(date_5000_reached as date) as dollar5000_reached_date,cast(date_of_alternate_vesting as date) as alternate_vesting_date,cast(date_of_birth as date) as birth_date,cast(date_of_death as date) as death_date,cast(date_of_employment as date) as employment_date,cast(date_of_last_alloc_percent_change as date) as last_alloc_pct_change_date,cast(date_of_last_transfer as date) as last_transfer_date,cast(date_of_plan_entry as date) as plan_entry_date,cast(date_of_suspension as date) as suspension_date,cast(date_of_termination as date) as termination_date,cast(death_benefit_percentage as integer) as death_benefit_percentage,default_deferral_flag as default_deferral_flag,default_investment_flag as default_investment_flag,cast(defer_date as date) as defer_date,deferral_grouping_id,cast(demographic_effective_date as date) as demographic_effective_date,cast(div_pass_thru_indicator as decimal(4,1)) as div_pass_thru_indicator,cast(dividend_pass_thru_election as DECIMAL(5,4)) as dividend_pass_thru_election,cast(dividend_pass_thru_election_percent as DECIMAL(4,1)) as divid_pass_thru_election_pct,cast(egtrra_target_message_id as INTEGER) as egtrra_target_message_id,cast(eligibility_completion_date as date) as eligibility_completion_date,eligibility_exclusion,cast(eligibility_reminder_date as date) as eligibility_reminder_date,eligible_for_bonus,cast(eligible_for_distribution_date as date) as eligible_for_distribution_date,cast(eligible_rollover_distributions as DECIMAL(11,2)) as elig_rollover_distributions,e_mail_address as email_address,employee_number,cast(null as varchar(10)) as employee_number_2,employment_status_reason,cast(equity_wash_amount as DECIMAL(11,2)) as equity_wash_amount,cast(er_after_tax as DECIMAL(11,2)) as er_after_tax,cast(esop_diversification_shares as DECIMAL(11,2)) as esop_diversification_shares,cast(excess_trader_suspend_end_date as date) as excess_trader_suspend_end_date,excess_trader_suspend_flag,cast(excess_trader_suspend_start_date as date) as excess_trader_susp_start_date,federal_participant_marital_status as federal_part_marital_status,federal_w4p_form_status,financial_engins_prospect_code,first_contribution_date,cast(first_default_contribution_date as date) as first_default_contrib_date, participant_16b_status,foreign_country_code,group_payment_status_flag,cast(hce_indicator as integer) as hce_indicator,cast(high_loan_balance_amount as DECIMAL(11,2)) as high_loan_balance_amount,cast(human_resouce_status_code as integer) as human_resouce_status_code,cast(ilip_equity_wash_residual_amount as DECIMAL(11,2)) as ilip_equity_wash_residual_amt,cast(init_partial_term_dist_date as date) as init_partial_term_dist_date,cast(init_rollover_dist_date as date) as init_rollover_dist_date,grp_iv_id as group_iv_id,cast(key_employee_indicator as integer) as key_employee_indicator,language_print_preference,cast(last_contrib_rate_change_date as date) as last_contrib_rate_change_date,cast(last_contribution_date as date) as last_contribution_date,cast(last_hardship_withdrawal_date as date) as last_hardship_withdrawal_date,cast(last_loan_default_date as date) as last_loan_default_date,cast(leave_of_absense_end_date as date) as leave_of_absense_end_date,cast(lifetime_dsc_amount as DECIMAL(11,2)) as lifetime_dsc_amount,cast(managed_account_salary_at_enrollment as DECIMAL(11,2)) as managed_acct_salary_at_enroll,match_payroll_generic_grouping,minimum_distribution_begin_time_option as min_distrib_begin_time_option,minimum_distribution_calculation_method as min_distrib_calculation_method,cast(minimum_distribution_eligibility_date as date) as min_distrib_eligibility_date,minimum_distribution_suppress_option as min_distrib_suppress_option,cast(mva_charged_to_date as date) as mva_charged_to_date,cast(net_401k_elective_deferrals as DECIMAL(11,2)) as net_401k_elective_deferrals,cast(next_rebalance_date as date) as next_rebalance_date,nonqual_ind,old_advice_account,cast(oracle_plan_rule_id as integer) as oracle_plan_rule_id,override_withholding,cast(override_withholding_amount as DECIMAL(11,2)) as override_withholding_amount,cast(override_withholding_percentage as DECIMAL(5,4)) as override_withholding_pct,participant_address_city,participant_address_line_3,participant_address_line_4,participant_address_state,participant_address_zip_code,cast(participant_fe_end_date as date) as participant_fe_end_date,cast(participant_fe_start_date as date) as participant_fe_start_date,participant_first_name,participant_last_name,participant_name_raw,participant_name as participant_name, participant_name_formatted,participant_status,pay_group_id,payroll_frequency, cast(periods_of_continuous_service as integer) as periods_of_continuous_service,cast(post_1986_employee_aftertax_contributions as DECIMAL(11,2)) as post1986_ee_aftertax_contrib,cast(pre_tax_401k_contribution_current as DECIMAL(11,2)) as pre_tax_401k_contrib_current,cast(pre_tax_401k_contribution_prior as DECIMAL(11,2)) as pre_tax_401k_contrib_prior,cast(pre_1987_employee_aftertax_contributions as DECIMAL(11,2)) as pre1987_ee_aftertax_contrib,cast(prior_hce_indicator as integer) as prior_hce_indicator,puerto_rico_resident,cast(qdia_date as date) as qdia_date, qdia_indicator,cast(qdro_beneficary_actual_ssn as DECIMAL(11,2)) as qdro_beneficary_actual_ssn,qdro_flag,reduction_401k_option,cast(reinstatement_notify_date as date) as reinstatement_notify_date,related_participant_id,cast(roll_contribution_current_year as DECIMAL(11,2)) as roll_contribution_current_year,cast(roll_contribution_prior_year as DECIMAL(11,2)) as roll_contribution_prior_year,cast(roth_cost_basis as Decimal(11,2)) as roth_cost_basis,cast(roth_deferral_contributions as DECIMAL(11,2)) as roth_deferral_contributions,cast(roth_first_contribution_date as date) as roth_first_contribution_date,cast(roth_iprr_contributions as decimal(11,2)) as roth_iprr_contributions,roth_sma_account_number,cast(null as decimal(11,2)) as roth_unrestricted_contrib,sdbo_hold_harmless,case  when sex='1' then 'MALE' when sex='2' then 'FEMALE' end as sex,sma_fund_balance,cast(spousal_consent_expiration_date as date) as spouse_consent_expiration_date,cast(spouse_birth_date as date) as spouse_birth_date,spouse_name,cast(suspension_months_ee_contributions as INTEGER) as suspension_months_ee_contrib,cast(suspension_months_er_contributions as INTEGER) as suspension_months_er_contrib,cast(suspension_months_forfeiture_reallocations as INTEGER) as suspension_months_forf_realloc,tax_treaty_country_code,cast(termination_notification_date as date) as termination_notification_date,termination_reason_code,cast(total_number_of_funds as INTEGER) as total_number_of_funds,cast(trade_activity as integer) as trade_activity,very_important_person_indicator as very_important_person_indicat,withdrawal_restriction,withdrawal_restriction_reason,'VRP-PB' as source_system,cast(null as VARCHAR(10)) as part_acc_status_text,cast(null as VARCHAR(6)) as part_product_id,cast(null as VARCHAR(11)) as part_type,cast(null as VARCHAR(1)) as flag_16B,cast(null as DECIMAL(17,2)) as last_contribution_amt_gross,cast(null as VARCHAR(6)) as part_acc_plan_code,cast(null as date) as enrollment_date,cast(null as date) as free_look_end_date,cast(null as VARCHAR(2)) as part_acc_prod_code,cast(null as VARCHAR(20)) as part_acc_prod_shrt_nm,cast(null as DATE) as part_acct_status_date,cast(null as VARCHAR(24)) as part_agg_sys_key,case when sex='1' then 'M' when sex='2' then 'F' end  as part_gender_code,cast(null as VARCHAR(3)) as part_line_of_business,cast(null as VARCHAR(4)) as part_location_code,cast(null as VARCHAR(25)) as part_middle_name,cast(null as VARCHAR(5)) as part_payrole_location,cast(null as VARCHAR(1)) as part_person_flag,cast(null as VARCHAR(32)) as part_phone,cast(null as VARCHAR(15)) as part_post88_surender,year(part_roth_first_contribution_date) as part_roth_year,cast(null as VARCHAR(4)) as  part_suffix,cast(null as VARCHAR(10)) as part_suffix_title,cast(null as VARCHAR(13)) as part_sys_key,cast(null as VARCHAR(15)) as part_ytd_ee_contrib,cast(null as VARCHAR(15)) as part_ytd_er_contrib,cast(null as VARCHAR(3)) as part_acc_company_code,cast(null as VARCHAR(55)) as participant_account_type,cast(participant_status as VARCHAR(10)) as participant_status_code,cast(null as VARCHAR(8)) as plan_reference_key,cast(null as VARCHAR(9)) as social_security_number,cast(source_cycle_date as date) as source_cycle_date,cast(in_tr_rest_flag as integer) as inside_trading_16b_restrict_id,last_crc_rate_chg_dt,term_stat_reason_code,cntrbs_txd_by_st_flg,cast(ee_cntrb_pty as decimal(7,2)) as ee_cntrb_pty,cast(ee_cntrb_ytd as decimal(7,2)) as ee_cntrb_ytd,date_of_eligibility as eligibility_date,cast(ytd_contributions as DECIMAL(15,2)) as ytd_contributions, cast(null as VARCHAR(10)) as  auto_enrollment_indicator, cast(null as INTEGER) as  hours_of_service, cast(null as VARCHAR(30)) as  participant_account_type_code, cast(null as VARCHAR(40)) as  participant_account_type_desc, cast(null as VARCHAR(1)) as  participant_catchup_eligible, cast(null as VARCHAR(255)) as  participant_address_line_1, cast(null as VARCHAR(255)) as  participant_address_line_2, case when qdia_indicator='1' then 'Y' else 'N' end  as  default_enrolled_qdia, cast(null as INTEGER) as  part_ytd_hours_worked, cast(null as VARCHAR(1)) as  participant_hce_status, cast(null as VARCHAR(1)) as  participant_installment_status, cast(part_number as VARCHAR(17)) as  participant_tin, cast(right(trim(part_number),4) as VARCHAR(4)) as  participant_tin_last_four, cast(null as INTEGER) as  marital_status, cast(null as VARCHAR(10)) as  code2, cast(null as INTEGER) as  ee_contrib_taxed_by_state, cast(null as VARCHAR(13)) as  alternate_account_number, cast(null as INTEGER) as  gender, cast(null as INTEGER) as  highly_compensated_ee_flag, cast(null as DATE) as  last_plan_to_plan_transf_date, case when participant_status<=16 then 'ACTIVE' when participant_status>=20 and participant_status<=35 then 'INACTIVE' end  as  participant_account_status_desc, cast(null as VARCHAR(13)) as  participant_employee_id, cast(null as INTEGER) as  participant_gender, cast(null as INTEGER) as  participant_gender_code, case when federal_participant_marital_status ='0' then 'UNKNOWN' when  federal_participant_marital_status ='1' then 'Single' when federal_participant_marital_status ='2' then 'Married' when federal_participant_marital_status ='3' then 'Married-Filing-Separately' when federal_participant_marital_status ='4' then 'Head-Of-Household' end as  participant_marital_status, cast(null as VARCHAR(30)) as  participant_name_protect, cast(null as VARCHAR(1)) as  participant_person_flag, cast(null as VARCHAR(1)) as  participant_qdro_status, cast(null as DECIMAL(15,2)) as  plan_year_compensation_current, cast(null as DECIMAL(15,2)) as  plan_year_compensation_prior, cast(null as DATE) as  processing_date, cast(null as VARCHAR(1)) as  roll_account_type, cast(null as DECIMAL(4,3)) as  source_adj_vest_percent, cast(null as DATE) as  source_processing_date,roth_catch_up_flag,cast(rehire_accum_hours as DECIMAL(11,2)) as rehire_accum_hours, rehire_ee_category, cast(rehire_effective_date as DATE) as rehire_effective_date, cast(rehire_last_change_date as DATE) as rehire_last_change_date,cast(loan_variable_loan_fee_amt as DECIMAL(16,2)) as  loan_variable_loan_fee_amt,loan_variable_loan_fee_payor,case when loan_variable_loan_fee_payor='S' then 'Sponsor Paid' when loan_variable_loan_fee_payor='P' then 'Participant Paid' else 'UNKNOWN' end as loan_fee_var_maint_payor_desc FROM exn_xxewre01_xxewrptd_ng")

    ng_merged_df = merge_dataframes(
        spark=spark,
        df1=exn_xxewre01_xxewrptd_ng_df,
        df2=super_omni_newr_particpantaccount_daily_ng_dat_df,
        primary_key=primary_key
    )

    jb_merged_df = merge_dataframes(
        spark=spark,
        df1=exn_xxewre01_xxewrptd_jb_df,
        df2=super_omni_newr_particpantaccount_daily_jb_dat_df,
        primary_key=primary_key
    )


    participant_temp_df = ng_merged_df.unionByName(jb_merged_df).unionByName(f950_rps_partcpnt_cef_data_ewr_df).unionByName(
        nw00paap_nlarc_prdps_partact_pdab_data_df)

    participant_temp_df.createOrReplaceTempView('participant_temp')

    part_bal_df=spark.sql("select core.plan_number, core.participant_id, core.core_balance, Cast( ( COALESCE(core.sdba_cash_value_amount, 0.00) + COALESCE(core.loan_balance, 0.00) + COALESCE(t3.life_balance, 0.00) ) AS DECIMAL(13, 2) ) as non_core_balance from ( select coalesce(t1.plan_number, t2.plan_number) as plan_number, coalesce(t1.participant_id, t2.participant_id) as participant_id, coalesce(t1.core_balance, 0) as core_balance, coalesce(t1.sdba_cash_value_amount, 0) as sdba_cash_value_amount, coalesce(t2.loan_balance, 0) as loan_balance from ( select plan_number, participant_id, sum(cash_value_amount) as core_balance, sum(sdba_cash_value_amount) as sdba_cash_value_amount from ( select coalesce(participant_id, '-9999') AS participant_id, coalesce(nullif(SOPB.plan_number, ''), '-9999') AS plan_number, coalesce(CAST(cash_value AS DECIMAL(17, 2)), 0) AS cash_value_amount, case when SOPB.fund_iv = '70' then COALESCE(CAST(cash_value AS DECIMAL(15, 2)), 0) else cast('0' as DECIMAL(15, 2)) end AS sdba_cash_value_amount from exn_xxewre01_xxewrpcb_jb SOPB left outer join exn_xxewre01_xxewrpfd_jb AS pf ON SOPB.plan_number = pf.plan_number AND SOPB.fund_iv = pf.fund_iv where not ( SOPB.client_id = 'AB' and ( pf.price_id in ('', '-9999') or pf.price_id is null ) and cash_value = 0 ) union all select coalesce(participant_id, '-9999') AS participant_id, coalesce(nullif(plan_number, ''), '-9999') AS plan_number, coalesce(CAST(cash_value AS DECIMAL(17, 2)), 0) AS cash_value_amount, COALESCE( CAST(brokerage_account_cash_value AS DECIMAL(15, 2)), 0 ) AS sdba_cash_value_amount from super_omni_newr_partsrcval_daily_ng_dat union all select coalesce(part_account_num, '-9999') AS participant_id, coalesce(nullif(plan_id, ''), '-9999') AS plan_number, coalesce(CAST(cash_value AS DECIMAL(17, 2)), 0) AS cash_value_amount, CAST(0 as DECIMAL(15, 2)) AS sdba_cash_value_amount from nw00paap_nlarc_prdps_partval_pdab_data union all select coalesce(part_acc_num, '-9999') AS participant_id, coalesce(nullif(plan_id, ''), '-9999') AS plan_number, coalesce(CAST(cash_value AS DECIMAL(17, 2)), 0) AS cash_value_amount, CAST(0 as DECIMAL(15, 2)) AS sdba_cash_value_amount from f950_rps_parsdba_bal_ewr_dat ) group by plan_number, participant_id ) as t1 full outer join ( select plan_number, participant_id, sum(loan_balance) as loan_balance from ( select coalesce(plan_id, '-9999') as plan_number, coalesce(participant_acc_num, '-9999') as participant_id, cast(outstanding_prncpl_bal_amt as decimal(17, 2)) as loan_balance from nw00paap_nlarc_prdps_partloan_pdab_data union all select plan_number, participant_id, case when loan_status_flag in ('1', '5', 'C') then cast('0' as DECIMAL(12, 2)) when loan_status_flag in ('2', '4', '6', '7') and date_diff( coalesce(source_cycle_date, current_date -1), date_of_previous_loan_payment ) > 365 then cast('0' as DECIMAL(12, 2)) else coalesce(cast(current_loan_balance as DECIMAL(12, 2)), 0) end as loan_balance from exn_xxewre01_xxewrppl_jb union all select plan_number, participant_id, case when loan_status_flag in ('1', '5', 'C') then cast('0' as DECIMAL(12, 2)) when loan_status_flag in ('2', '4', '6', '7') and date_diff( coalesce(source_cycle_date, current_date -1), date_of_previous_loan_payment ) > 365 then cast('0' as DECIMAL(12, 2)) else coalesce(cast(current_loan_balance as DECIMAL(12, 2)), 0) end as loan_balance from exn_xxewre01_xxewrppl_ng ) group by plan_number, participant_id ) t2 on t1.participant_id = t2.participant_id and t1.plan_number = t2.plan_number ) as core left join ( select plan_id as plan_number, participant_account_number as participant_id, sum(CAST(cash_value_amt as DECIMAL(11, 2))) as life_balance from super_omni_newr_lifeval_monthly_ng_dat group by plan_id, participant_account_number ) as t3 on t3.participant_id = core.participant_id and t3.plan_number = core.plan_number")

    part_bal_df.createOrReplaceTempView("part_bal")





    transform_df = spark.sql("SELECT  coalesce(nullif(trim(pt.client_id),''),'-9999') as client_id,coalesce(nullif(pt.participant_id,''),'-9999') as participant_id,coalesce(nullif(pt.plan_number,''),'-9999') as plan_number,coalesce(nullif(pt.retirement_account_id,''),'-9999') as retirement_account_id,pt.plan_reference_key,pt.source_system,pt.part_product_id,pt.part_acc_plan_code as plan_code,pt.age,pt.part_acct_status_date,pt.part_type,case when pt.plan_entry_date >= to_date('0001-01-01') and pt.plan_entry_date <= to_date('9999-12-31') then cast(pt.plan_entry_date as date) else null end as plan_entry_date,pt.participant_tin as part_ssn,pt.participant_tin_last_four as part_ssn_last_4,pt.birth_date,pt.attained_age,pt.part_gender_code as gender_code,pt.sex as gender_desc, pt.part_person_flag,pt.participant_first_name as first_name,pt.participant_last_name as last_name,pt.part_suffix as name_suffix,pt.participant_address_line_1 as part_address_line_1,pt.participant_address_line_2 as part_address_line_2,pt.participant_address_line_3 as part_address_line_3,pt.participant_address_city as part_address_city,pt.participant_address_state as part_address_state,pt.participant_address_zip_code as part_address_zip_code,pt.country_name,pt.part_line_of_business as line_of_business,pt.processing_date,pt.ee_contrib_401k_state_tax_flag,pt.ee_contrib_401k_current_year,pt.ee_contrib_401k_prior_year,pt.eligibility_5500_date,pt.account_inception_date,pt.addl_high_outst_loan_balance as highest_outstand_loan_balance,pt.address_validity,pt.advice_account_indicator,pt.advice_account_rebal_freq,pt.advice_target_message_1,pt.advice_target_message_2,pt.advice_target_message_3,pt.alternate_taxability_state,pt.alternate_vesting_date,pt.annual_dist_amount,pt.annual_salary,pt.auto_enrollment_date,pt.auto_enrollment_indicator,pt.automatic_increase_flag,pt.beneficiary_code,pt.brokerage_account_number,pt.client_pass_thru_identifier,pt.client_status,pt.contribution_415_current,pt.contribution_415_prior,pt.death_benefit_percentage,pt.death_date,pt.default_deferral_flag,pt.default_enrolled_qdia,pt.default_investment_flag,pt.defer_date,pt.deferral_grouping_id,pt.demographic_effective_date,pt.div_pass_thru_indicator as dividend_pass_thru_indicator,pt.div_sub_id,pt.dividend_pass_thru_election,pt.divid_pass_thru_election_pct as dividend_pass_thru_election_pct,pt.dollar5000_reached_date,pt.ee_contrib_taxed_by_state,pt.egtrra_target_message_id,pt.eligibility_completion_date,pt.eligibility_date,pt.eligibility_exclusion,pt.eligibility_reminder_date,pt.eligible_for_bonus,pt.eligible_for_distribution_date,pt.elig_rollover_distributions,pt.email_address,pt.employee_number,pt.employee_number_2,pt.alternate_account_number,pt.employment_date,pt.employment_status_reason,pt.enrollment_date,pt.equity_wash_amount,pt.er_after_tax as er_after_tax_amount,pt.esop_diversification_shares,case when pt.excess_trader_suspend_end_date >= to_date('0001-01-01') and pt.excess_trader_suspend_end_date <= to_date('9999-12-31') then cast(pt.excess_trader_suspend_end_date as date) else null end as excess_trader_suspend_end_date,pt.excess_trader_suspend_flag,pt.excess_trader_susp_start_date,case when pt.federal_part_marital_status in ('0','1','4') then 'N' when pt.federal_part_marital_status  in ('2','3') then 'Y' end  as marital_status_code,pt.federal_w4p_form_status,pt.financial_engins_prospect_code,case when pt.first_contribution_date >= to_date('0001-01-01') and pt.first_contribution_date <= to_date('9999-12-31') then cast(pt.first_contribution_date as date) else null end as first_contribution_date,pt.first_default_contrib_date,pt.flag_16B,pt.foreign_country_code,pt.free_look_end_date,pt.group_payment_status_flag,pt.hce_indicator,pt.high_loan_balance_amount,pt.highly_compensated_ee_flag,pt.hours_of_service,pt.human_resouce_status_code as human_resource_status_code,pt.ilip_equity_wash_residual_amt,pt.init_partial_term_dist_date,pt.init_rollover_dist_date,pt.key_employee_indicator,pt.language_print_preference,pt.last_alloc_pct_change_date,pt.last_contrib_rate_change_date,pt.last_contribution_amt_gross,pt.last_contribution_date,pt.last_hardship_withdrawal_date,pt.last_loan_default_date,pt.last_plan_to_plan_transf_date,pt.last_transfer_date,case when pt.leave_of_absense_end_date >= to_date('0001-01-01') and pt.leave_of_absense_end_date <= to_date('9999-12-31') then cast(pt.leave_of_absense_end_date as date) else null end as leave_of_absense_end_date,pt.lifetime_dsc_amount,pt.managed_acct_salary_at_enroll,pt.match_payroll_generic_grouping,pt.min_distrib_begin_time_option as min_distrib_begin_date_option ,pt.min_distrib_calculation_method,pt.min_distrib_eligibility_date,pt.min_distrib_suppress_option,pt.mva_charged_to_date,pt.net_401k_elective_deferrals,case when pt.next_rebalance_date >= to_date('0001-01-01') and pt.next_rebalance_date <= to_date('9999-12-31') then cast(pt.next_rebalance_date as date) else null end as next_rebalance_date,pt.nonqual_ind,pt.old_advice_account,pt.oracle_plan_rule_id,pt.override_withholding as withholding_override,pt.override_withholding_amount as withholding_amount_override,pt.override_withholding_pct as withholding_pct_override,pt.part_acc_prod_code as product_code,pt.part_acc_prod_shrt_nm as product_name,pt.part_agg_sys_key as agg_sys_key,pt.part_location_code as location_code,pt.part_middle_name as middle_name,pt.part_payrole_location as payroll_location,pt.part_phone as phone,pt.part_post88_surender as post88_surender,pt.part_roth_year as roth_year,pt.roth_cost_basis  as roth_cost_basis,pt.part_ytd_hours_worked as ytd_hours_worked,pt.participant_16b_status as status_16B,pt.participant_account_status_desc as part_status_desc,pt.participant_account_type as account_type,pt.participant_account_type_code as account_type_code,pt.participant_account_type_desc as account_type_code_desc,pt.participant_address_line_4 as part_address_line_4,pt.participant_catchup_eligible as catchup_eligible_flag,pt.participant_employee_id as employee_id,case when pt.participant_fe_end_date >= to_date('0001-01-01') and pt.participant_fe_end_date <= to_date('9999-12-31') then cast(pt.participant_fe_end_date as date) else null end as fe_end_date,pt.participant_fe_start_date as fe_start_date,pt.participant_hce_status as hce_status,pt.participant_installment_status as installment_status,pt.participant_marital_status as marital_status_code_desc,pt.participant_name,pt.participant_name_formatted as name_formatted,case when pt.part_gender_code in ('M','F') then 'Y' end  as person_flag,pt.participant_qdro_status as qdro_status,pt.participant_status_code,pt.pay_group_id,pt.payroll_frequency,pt.periods_of_continuous_service,pt.plan_year_compensation_current,pt.group_iv_id,pt.plan_year_compensation_prior,pt.post1986_ee_aftertax_contrib,pt.pre_tax_401k_contrib_current,pt.pre_tax_401k_contrib_prior,pt.pre1987_ee_aftertax_contrib,pt.prior_hce_indicator,pt.puerto_rico_resident,case when pt.qdia_date >= to_date('0001-01-01') and pt.qdia_date <= to_date('9999-12-31') then cast(pt.qdia_date as date) else null end as qdia_date,pt.qdia_indicator,pt.qdro_beneficary_actual_ssn as qdro_beneficary_ssn,pt.qdro_flag,pt.reduction_401k_option,case when pt.reinstatement_notify_date >= to_date('0001-01-01') and pt.reinstatement_notify_date <= to_date('9999-12-31') then cast(pt.reinstatement_notify_date as date) else null end as reinstatement_notify_date,pt.related_participant_id,pt.roll_account_type,pt.roll_contribution_current_year,pt.roll_contribution_prior_year,pt.roth_deferral_contributions,case when pt.roth_first_contribution_date >= to_date('0001-01-01') and pt.roth_first_contribution_date <= to_date('9999-12-31') then cast(pt.roth_first_contribution_date as date) else null end as roth_first_contribution_date,pt.roth_iprr_contributions,pt.roth_sma_account_number,pt.roth_unrestricted_contrib,pt.sdbo_hold_harmless,case when pt.sma_fund_balance = '1             0.0' or pt.sma_fund_balance = '1             0.' then 0.00 else pt.sma_fund_balance end as sma_fund_balance,pt.source_adj_vest_percent,pt.source_cycle_date,pt.spouse_consent_expiration_date,case when pt.spouse_birth_date >= to_date('0001-01-01') and pt.spouse_birth_date <= to_date('9999-12-31') then cast(pt.spouse_birth_date as date) else null end as spouse_birth_date,pt.spouse_name,pt.suspension_date,pt.suspension_months_ee_contrib,pt.suspension_months_er_contrib,pt.suspension_months_forf_realloc,pt.tax_treaty_country_code,pt.termination_date,case when pt.termination_notification_date >= to_date('0001-01-01') and pt.termination_notification_date <= to_date('9999-12-31') then cast(pt.termination_notification_date as date) else null end as termination_notification_date,pt.termination_reason_code,pt.total_number_of_funds,pt.trade_activity,pt.very_important_person_indicat,pt.withdrawal_restriction,pt.withdrawal_restriction_reason,pt.inside_trading_16b_restrict_id,case when pt.last_crc_rate_chg_dt >= to_date('0001-01-01') and pt.last_crc_rate_chg_dt <= to_date('9999-12-31') then cast(pt.last_crc_rate_chg_dt as date) else null end as last_crc_rate_chg_dt,pt.term_stat_reason_code,pt.cntrbs_txd_by_st_flg as state_contrib_taxed_by_flag,pt.ee_cntrb_pty as ee_contrib_prior_tax_year,pt.ee_cntrb_ytd as ee_contrib_ytd,pt.ytd_contributions,pt.roth_catch_up_flag, pt.rehire_accum_hours, pt.rehire_ee_category, pt.rehire_effective_date, pt.rehire_last_change_date,pt.loan_variable_loan_fee_amt,pt.loan_variable_loan_fee_payor,pt.loan_fee_var_maint_payor_desc, cust.cust_ods_agreement_id, case when pt.participant_account_status_desc='ACTIVE' then 'Y' when pt.participant_account_status_desc='INACTIVE' and (pb.core_balance+pb.non_core_balance)>0 then 'Y' when pt.participant_account_status_desc='INACTIVE' and (pb.core_balance+pb.non_core_balance)<=0 then 'N' when pt.participant_account_status_desc is null  and (pb.core_balance+pb.non_core_balance)>0 then 'Y'  else 'N' end as is_participant  from participant_temp as pt left outer join ods_retirement_account as cust on coalesce(pt.plan_number,'-9999') = coalesce(cust.plan_number,'-9999') and coalesce(pt.participant_id,'-9999') = coalesce(cust.participant_id,'-9999') left outer join part_bal  as pb on coalesce(pt.plan_number,'-9999') = coalesce(pb.plan_number,'-9999') and coalesce(pt.participant_id,'-9999') = coalesce(pb.participant_id,'-9999')")


    return transform_df