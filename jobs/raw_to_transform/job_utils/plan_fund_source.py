
from pyspark.sql import SparkSession
from pyspark.sql.functions import *


def transform(spark: SparkSession, primary_key: list):

    exn_xxewre01_xxewrpfs_jb_df = spark.sql("select client_id, plan_number, fund_iv, money_source, fund_money_source_name as fund_name, cast(contribution_allocation_percentage as DECIMAL(5,4)) as contribn_allocation_percentage, cast(contributions_gross as DECIMAl(15,2)) as contributions_gross, cast(contributions_reserve_current as DECIMAl(15,2)) as contributions_reserve_current, cast(contributions_reserve_reallocated as DECIMAl(15,2)) as contribn_reserve_reallocated, cast(conversions_in  as DECIMAl(15,2)) as conversions_in, cast(conversions_out as DECIMAl(15,2)) as conversions_out, cast(earnings_cash as DECIMAl(15,2)) as earnings_cash, cast(earnings_dividend as DECIMAl(15,2)) as earnings_dividend, cast(earnings_gain_loss_on_shares_units as DECIMAl(15,2)) as eargs_gain_or_loss_on_shares, cast(earnings_reserve_current as DECIMAl(15,2)) as earnings_reserve_current, cast(fee_disbursements as DECIMAl(15,2)) as fee_disbursements, cast(fees_reserve_current as DECIMAl(15,2)) as fees_reserve_current, cast(forfeitures_credited as DECIMAl(15,2)) as forfeitures_credited, cast(forfeitures_debited as DECIMAl(15,2)) as forfeitures_debited, cast(forfeitures_reserve_current as DECIMAl(15,2)) as forfeitures_reserve_current, cast(forfeitures_reserve_reallocated_as_contributions as DECIMAl(15,2)) as forf_reserve_realloc_contribn, cast(forfeitures_reserve_reallocated_as_forfeitures as DECIMAl(15,2)) as forf_reserve_realloc_as_forf, cast(installment_disbursements as DECIMAl(15,2)) as installment_disbursements, cast(insurance_premium_itd as DECIMAl(15,2)) as insurance_premium_itd, loan_eligibility, cast(loan_issues as DECIMAl(15,2)) as loan_issues, cast(loan_repayment_interest as DECIMAl(15,2)) as loan_repayment_interest, cast(loan_repayment_principal as DECIMAl(15,2)) as loan_repayment_principal, cast(market_value as DECIMAL(15,2)) as market_value , cast(miscellaneous_debits as DECIMAl(15,2)) as miscellaneous_debits, cast(miscellaneous_receipts as DECIMAl(15,2)) as miscellaneous_receipts, cast(miscellaneous_reserve_current as DECIMAl(15,2)) as miscellaneous_reserve_current, cast(net_contributions_current as DECIMAl(15,2)) as net_contributions_current, cast(net_dollars as DECIMAl(15,2)) as net_dollars, cast(other_credits as DECIMAl(15,2)) as other_credits, cast(other_debits as DECIMAl(15,2)) as other_debits, cast(plan_transfer_in as DECIMAl(15,2)) as plan_transfer_in, cast(plan_transfers_out as DECIMAl(15,2)) as plan_transfers_out, cast(share_unit_balance_current as DECIMAL(17,4)) as share_or_unit_balance_current, cast(shares_units_distributed as DECIMAL(17,4)) as shares_distributed, cast(shares_units_forfeited as DECIMAL(17,4)) as shares_forfeited, cast(shares_units_purchased as DECIMAL(17,4)) as shares_purchased, cast(shares_units_receipted as DECIMAL(17,4)) as shares_receipted, cast(shares_units_sold as DECIMAL(15,2)) as shares_sold, cast(termination_disbursements as DECIMAL(15,2)) as termination_disbursements, cast(transfers_in  as DECIMAL(15,2)) as transfers_in, cast(transfers_out as DECIMAL(15,2)) as transfers_out, cast(uninvested_cash_current as DECIMAL(15,2)) as uninvested_cash_current, cast(withdrawal_disbursements as DECIMAL(15,2)) as withdrawal_disbursements, 'VRP-SP' as source_system, cast(source_cycle_date as DATE) from exn_xxewre01_xxewrpfs_jb")

    exn_xxewre01_xxewrpfs_ng_df = spark.sql("select client_id, plan_number, fund_iv, money_source, fund_money_source_name as fund_name, cast(contribution_allocation_percentage as DECIMAL(5,4)) as contribn_allocation_percentage, cast(contributions_gross as DECIMAl(15,2)) as contributions_gross, cast(contributions_reserve_current as DECIMAl(15,2)) as contributions_reserve_current, cast(contributions_reserve_reallocated as DECIMAl(15,2)) as contribn_reserve_reallocated, cast(conversions_in  as DECIMAl(15,2)) as conversions_in, cast(conversions_out as DECIMAl(15,2)) as conversions_out, cast(earnings_cash as DECIMAl(15,2)) as earnings_cash, cast(earnings_dividend as DECIMAl(15,2)) as earnings_dividend, cast(earnings_gain_loss_on_shares_units as DECIMAl(15,2)) as eargs_gain_or_loss_on_shares, cast(earnings_reserve_current as DECIMAl(15,2)) as earnings_reserve_current, cast(fee_disbursements as DECIMAl(15,2)) as fee_disbursements, cast(fees_reserve_current as DECIMAl(15,2)) as fees_reserve_current, cast(forfeitures_credited as DECIMAl(15,2)) as forfeitures_credited, cast(forfeitures_debited as DECIMAl(15,2)) as forfeitures_debited, cast(forfeitures_reserve_current as DECIMAl(15,2)) as forfeitures_reserve_current, cast(forfeitures_reserve_reallocated_as_contributions as DECIMAl(15,2)) as forf_reserve_realloc_contribn, cast(forfeitures_reserve_reallocated_as_forfeitures as DECIMAl(15,2)) as forf_reserve_realloc_as_forf, cast(installment_disbursements as DECIMAl(15,2)) as installment_disbursements, cast(insurance_premium_itd as DECIMAl(15,2)) as insurance_premium_itd, loan_eligibility, cast(loan_issues as DECIMAl(15,2)) as loan_issues, cast(loan_repayment_interest as DECIMAl(15,2)) as loan_repayment_interest, cast(loan_repayment_principal as DECIMAl(15,2)) as loan_repayment_principal, cast(market_value as DECIMAL(15,2)) as market_value, cast(miscellaneous_debits as DECIMAl(15,2)) as miscellaneous_debits, cast(miscellaneous_receipts as DECIMAl(15,2)) as miscellaneous_receipts, cast(miscellaneous_reserve_current as DECIMAl(15,2)) as miscellaneous_reserve_current, cast(net_contributions_current as DECIMAl(15,2)) as net_contributions_current, cast(net_dollars as DECIMAl(15,2)) as net_dollars, cast(other_credits as DECIMAl(15,2)) as other_credits, cast(other_debits as DECIMAl(15,2)) as other_debits, cast(plan_transfer_in as DECIMAl(15,2)) as plan_transfer_in, cast(plan_transfers_out as DECIMAl(15,2)) as plan_transfers_out, cast(share_unit_balance_current as DECIMAL(17,4)) as share_or_unit_balance_current, cast(shares_units_distributed as DECIMAL(17,4)) as shares_distributed, cast(shares_units_forfeited as DECIMAL(17,4)) as shares_forfeited, cast(shares_units_purchased as DECIMAL(17,4)) as shares_purchased, cast(shares_units_receipted as DECIMAL(17,4)) as shares_receipted, cast(shares_units_sold as DECIMAL(15,2)) as shares_sold, cast(termination_disbursements as DECIMAL(15,2)) as termination_disbursements, cast(transfers_in  as DECIMAL(15,2)) as transfers_in, cast(transfers_out as DECIMAL(15,2)) as transfers_out, cast(uninvested_cash_current as DECIMAL(15,2)) as uninvested_cash_current, cast(withdrawal_disbursements as DECIMAL(15,2)) as withdrawal_disbursements, 'VRP-PB' as source_system, cast(source_cycle_date as DATE) from exn_xxewre01_xxewrpfs_ng")

    transform_df = exn_xxewre01_xxewrpfs_jb_df.unionByName(exn_xxewre01_xxewrpfs_ng_df)

    return transform_df